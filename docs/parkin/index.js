var un=Object.create;var mt=Object.defineProperty;var ln=Object.getOwnPropertyDescriptor;var pn=Object.getOwnPropertyNames;var mn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var hn=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),dn=(r,n)=>{for(var s in n)mt(r,s,{get:n[s],enumerable:!0})},Jr=(r,n,s,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of pn(n))!fn.call(r,u)&&u!==s&&mt(r,u,{get:()=>n[u],enumerable:!(i=ln(n,u))||i.enumerable});return r};var T=(r,n,s)=>(s=r!=null?un(mn(r)):{},Jr(n||!r||!r.__esModule?mt(s,"default",{value:r,enumerable:!0}):s,r)),gn=r=>Jr(mt({},"__esModule",{value:!0}),r);var w=hn((ft,Kr)=>{(function(r,n){typeof ft=="object"&&typeof Kr<"u"?n(ft):typeof define=="function"&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).jsutils={})})(ft,function(r){"use strict";let n={SHOULD_LOG:!0,SHOULD_THROW:!1,LOG_PREFIX:null},s=()=>!0,i=(t,e={},o={})=>{let{logs:c=n.SHOULD_LOG,throws:a=n.SHOULD_THROW,prefix:p=n.LOG_PREFIX}=o,h=Object.entries(t).map(([$,J])=>u($,J,e[$]||e.$default||s)),{success:g,cases:_}=h.reduce(($,J)=>l($,J,{logs:c,throws:a,prefix:p}),{success:!0,cases:{}});return[g,_]};i.setOptions=({logs:t,throws:e,prefix:o})=>{t!==void 0&&(n.SHOULD_LOG=t),e!==void 0&&(n.SHOULD_THROW=e),o!==void 0&&(n.LOG_PREFIX=o)},i.resetOptions=()=>{n.SHOULD_LOG=!0,n.SHOULD_THROW=!1,n.LOG_PREFIX=null};let u=(t,e,o)=>{let c=o(e),a=!o.name||o.name===t||o.name==="$default"?o.toString():o.name;return{success:c,key:t,value:e,validator:o,reason:c?null:[`Argument "${t}" with value `,e,` failed validator: ${a}.`]}},l=(t,e,{logs:o,throws:c,prefix:a})=>(!e.success&&f(e,o,c,a),{success:t.success&&e.success,cases:{...t.cases,[e.key]:e}}),f=(t,e,o,c)=>{let a=c?[c,...t.reason]:t.reason;if(o)throw new Error(a.join());e&&console.error(...a)},m=t=>Array.isArray(t),O=t=>{let e=new Map;for(let c=0;c<t.length;c++){var o;let a=t[c],p=(o=e.get(a))!==null&&o!==void 0?o:0;e.set(a,p+1)}return e},E=(t,e)=>{if(t.size!==e.size)return!1;for(let[o,c]of t)if(e.get(o)!==c)return!1;return!0},x=t=>typeof t=="object"&&!Array.isArray(t)&&t!==null,y=t=>m(t)?t:[t],d=t=>typeof t=="function",M=t=>(Object.freeze(t),Object.getOwnPropertyNames(t).map(e=>{t.hasOwnProperty(e)&&t[e]!==null&&(typeof t[e]=="object"||d(t[e]))&&!Object.isFrozen(t[e])&&M(t[e])}),t),ut=Object.freeze({}),N=M({content:{}}),tn=M([]),et=t=>t==t&&t!=null,pr=(t,e,o)=>{for(let c=0;c<t.length;c++){let a=t[c];m(a)?pr(a,e,o):o.exists&&!et(a)||o.truthy&&!a||e.push(a)}return o.mutate?(Object.assign(t,e).splice(e.length),t):e},mr=(t,e)=>pr(t,[],x(e)?e:ut),fr=(t,e)=>{if(m(e)){let[o,...c]=e;return o(t,...c)}return d(e)?e(t):(console.error("Pipeline expected either a function or an array (for function expressions). Found "+typeof e),t)},Ft=(t,...e)=>e.reduce((o,c)=>fr(o,c),t),R=t=>typeof t=="string",hr=(t,e)=>{if(!R(t)||!d(e))return t;let o="";for(let c of t)o+=e(c);return o},dr=t=>t===t.toLowerCase(),gr=t=>t===t.toUpperCase(),xr=(t,e,o=["-","_"," "])=>{if(!R(t))return t;let c=p=>o.some(h=>h===p),a="_";return hr(t,p=>c(p)?(a=e,e):gr(p)&&dr(a)&&!c(a)?(a=p,e+p):(a=p,p))},lt=(t,e=!0)=>{if(!R(t)||!t[0])return t;let o=e?t.slice(1).toLowerCase():t.slice(1);return`${t[0].toUpperCase()}${o}`},Rr=t=>{let e=t.indexOf(".")===0?t.slice(1):t;return e.indexOf(".")===e.length-1?e.slice(0,-1):e},Pt=t=>t&&Rr(t).replace(/[-_]/gm," ")||t,Or=(t,e)=>t&&Pt(t).split(/[\s_-]/gm).reduce((o,c,a)=>c?o+=(a>0||e)&&lt(c)||c.toLowerCase():o,"")||t,B=t=>t==null?"":R(t)?t:JSON.stringify(t),rn=/[A-Z]/g,en=/^ms-/,It={},nn=t=>"-"+t.toLowerCase(),q=t=>typeof t=="number"&&t!=t,b=t=>typeof t=="number"&&!q(t),Ct=t=>b(t)&&t>=0,yr=t=>R(t)&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||t,L=t=>typeof t=="object"&&t!==null,Mt=(t,e,o,c)=>{let a=t;if(!L(t)||!t||!e)return o!=="set"&&c||void 0;let p=m(e)?Array.from(e):e.split("."),h=p.pop(),g,_;for(;g=p.shift();){let $=t[g];if(L($)||d($)?t=$:(o==="set"?t[g]={}:_=!0,t=t[g]),_)return c}return o==="get"?h in t?t[h]:c:o==="unset"?delete t[h]:(t[h]=c)&&a||a},nt=(t,e,o)=>Mt(t,e,"get",o),_r=(t,e,o="")=>{e=L(e)&&e||{};let c=_r.regex||/\${(.*?)\}/g;return R(t)?t.replace(c,(a,p)=>{let h=(p||a.substr(2,a.length-3)).trim(),g=nt(e,h,o);return d(g)?g(e,h,o):g}):console.error("template requires a string as the first argument")||t},on=['"',"'"],vt=t=>{if(!R(t))return;let e="";for(let o of t)e=o+e;return e},Ar=(t,e,o)=>o.map(c=>t.indexOf(c,e)).sort().find(c=>c>=0),Er=(t,e,o=[" "])=>{let c=Ar(t,e,o);return t.substring(e,c===-1?t.length:c)},pt=t=>typeof t=="boolean",Xt=t=>t==="false"||t==="true",br=t=>pt(t)?B(t):t&&t!=="false"&&t!=="0"?"true":"false",$r=t=>Boolean(t||t===""||t===0),Dt=t=>Xt(t)?t==="true":br(t)==="true",ot=t=>B(t).replace(/([^.\d])/gm,""),Nt=t=>b(t)?t:t&&!q(t)&&Number(ot(t))||0,wr=t=>R(t)||b(t)||pt(t),kt=(t,e)=>{let[o]=i({x:t,y:e},{$default:wr});return o?R(t)?t.localeCompare(e):t-e:null},Ut=t=>t,Tr=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Wt=t=>{let e=function(...o){return t instanceof e||nt(t.prototype,"constructor.name")?new t(...o):t.apply(t,o)};for(let o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return Object.defineProperty(e,"name",{value:t.name,configurable:!0}),e.toString=()=>t.toString(),e},v=(t,e=new WeakMap)=>{if(Object(t)!==t)return t;if(t instanceof Set)return new Set(t);if(e.has(t))return e.get(t);if(m(t))return t.map(c=>v(c));if(d(t))return Wt(t);let o=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t.constructor?null:Object.create(null);return o===null?Sr(t):(e.set(t,o),t instanceof Map?Array.from(t,([c,a])=>o.set(c,v(a,e))):Object.assign(o,...Object.keys(t).map(c=>({[c]:v(t[c],e)}))))},Sr=t=>{if(!t)return t;let e=Object.getPrototypeOf(t),o=Object.getOwnPropertyDescriptors(t);for(let[a,p]of Object.entries(o))p.value&&(o[a].value=v(p.value));let c=Object.create(e,o);return Object.isFrozen(t)&&Object.freeze(c),Object.isSealed(t)&&Object.seal(c),c},jr=t=>t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,jr),Lr=t=>Object.prototype.toString.call(t).slice(8,-1),Fr=(t,...e)=>{if(!e.length)return null;for(let o of e){if(!m(o)){console.error(`Matching case must be an entry (a 2-element array). Found: ${Lr(o)}`,o);break}let[c,a]=o;if(d(c)&&c(t)||c===t)return a}return null};Fr.default=()=>!0;let Pr=t=>x(t)?Object.keys(t).length===0:m(t)?t.length===0:R(t)?t.trim().length===0:!!b(t)&&t<1,Ht=(t,e)=>{let[o]=i({arr:t,comparator:e},{arr:m,$default:d});return o&&t.length?t.reduce((c,a)=>e(c,a)>0?c:a):null},Ir=t=>m(t)?t.filter((e,o,c)=>c.indexOf(e)==o):t,Cr=(t,e)=>{if(!e)return Ir(t);let{unique:o}=t.reduce((c,a)=>{let p=e(a);return!c.set.has(p)&&c.unique.push(a),c.set.add(p),c},{unique:[],set:new Set});return o},Mr=(t,e=!0)=>L(t)?Object.keys(t).reduce((o,c)=>{let a=t[c];return a==null||(o[c]=e&&L(a)?Mr(a):a),o},x(t)&&{}||[]):console.error("cleanColl requires a collection as the first argument")||t,zt=(t,e,o)=>Mt(t,e,"set",o),vr=Array.isArray,Xr=Object.keys,sn=Object.prototype.hasOwnProperty,Bt=(t,e)=>{if(t===e)return!0;if(!t||!e||typeof t!="object"||typeof e!="object")return t!=t&&e!=e;let o=vr(t),c=vr(e),a,p,h;if(o&&c){if(p=t.length,p!=e.length)return!1;for(a=p;a--!=0;)if(!Bt(t[a],e[a]))return!1;return!0}if(o!=c)return!1;let g=t instanceof Date,_=e instanceof Date;if(g!=_)return!1;if(g&&_)return t.getTime()==e.getTime();let $=t instanceof RegExp,J=e instanceof RegExp;if($!=J)return!1;if($&&J)return t.toString()==e.toString();let Jt=Xr(t);if(p=Jt.length,p!==Xr(e).length)return!1;for(a=p;a--!=0;)if(!sn.call(e,Jt[a]))return!1;for(a=p;a--!=0;)if(h=Jt[a],!Bt(t[h],e[h]))return!1;return!0},Dr=t=>t&&R(t)?Xt(t)?Dt(t):b(t)?Nt(t):(()=>{try{return JSON.parse(t)}catch{return t}})():t,qt,st="dir",G="type",cn=["error","info","log","dir","warn"],Nr=(...t)=>{if(!t.length)return;let e=t.length===1?st:t.pop();(qt||e==="error")&&(typeof t[0]=="string"&&(G==="type"?t[0]=`[ ${e.toUpperCase()} ] ${t[0]}`:G&&(t[0]=`${G} ${t[0]}`)),cn.indexOf(e)!==-1?console[e](...t):console[st](...t,e))},kr=(t,e)=>{t&&Object.entries(t).map(([o,c])=>{e&&e.indexOf(o)!==-1||(typeof c=="object"&&kr(c),t[o]=void 0,delete t[o])})},Ur=(...t)=>t.reduce((e,o)=>{let c=v(o);return m(c)?[...m(e)&&e||[],...c]:x(c)?Object.entries(c).reduce((a,[p,h])=>({...a,[p]:d(h)?Wt(h):L(h)&&p in a?Ur(a[p],h):v(h)}),e):e},m(t[0])&&[]||{}),Wr=t=>m(t)&&t.length===2&&(b(t[0])||R(t[0])),Hr=(t,e)=>{if(!m(t)&&!x(t))return console.error(t,"Expected array or object for obj. Found "+typeof t),t;if(!d(e))return console.error("Expected function for cb. Found "+typeof e),t;let o=Object.entries(t),c=m(t)?[]:{};return o.reduce((a,[p,h])=>{let g=e(p,h);return Wr(g)?zt(a,g[0],g[1]):(console.error(`Callback function must return entry. Found: ${g}. Using current entry instead.`),zt(a,p,h))},c)},ct=(t,e,o={})=>x(t)&&d(e)&&Object.entries(t).reduce((c,[a,p])=>e(a,p,c),o)||o,Gt=t=>{if(!d(t))throw"Argument must be a function";return(...e)=>new Promise((o,c)=>d(e[e.length-1])?(e.pop(),e.push((...a)=>a&&a[0]?c(...a):o(...a)),t(...e)):o(t(...e)))},an=Array.from(["caller","callee","arguments","apply","bind","call","toString","__proto__","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString"]).concat(Object.getOwnPropertyNames(Object.prototype)).reduce((t,e)=>(t[e]=!0,t),{}),zr=t=>{if(!t.__IS_PROMISIFIED__){for(let e of Object.getOwnPropertyNames(t))if(!(e.indexOf("Async")!==-1||t[`${e}Async`])&&!an[e])if(d(t[e]))t[`${e}Async`]=Gt(t[e]);else{let o=Object.getOwnPropertyDescriptor(t,e).get;d(o)&&(t[`${e}Async`]=Gt(o))}t.__IS_PROMISIFIED__=!0}return t},Br=t=>Boolean(t&&t instanceof RegExp),qr=t=>Br(t)?t.source:R(t)?t:null,Gr=t=>{let e={},o=t.split("?"),c=o[o.length-1];if(!c)return e;let a=c.split("&");return a.length&&a.map(p=>{let h=p.split("=");if(h.length<=1)return e;let g=[h.shift(),h.join("=")];if(g.length===2){let _=decodeURIComponent(g[1]).split(",");if(_&&_.length>1)e[g[0]]=_;else if(g[0]in e){let $=e[g[0]];e[g[0]]=m($)?$.push(decodeURIComponent(g[1])):[$,decodeURIComponent(g[1])]}else e[g[0]]=decodeURIComponent(g[1])}}),e};r.applyToCloneOf=(t,e)=>{let o;if(t||(o="object (Argument 1) in applyToCloneOf, must be defined!"),x(t)||(o="object (Argument 1) in applyToCloneOf, must be an object!"),e||(o="mutator (Argument 2) in applyToCloneOf, must be defined!"),d(e)||(o="mutator (Argument 2) arg in applyToCloneOf, must be a function!"),o)return console.warn(o)||t;let c=v(t);return e(c),c},r.applyToFunc=fr,r.areCountMapsEqual=E,r.areFrequencyEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;if(t.length!==e.length)return!1;let c=O(t),a=O(e);return E(c,a)},r.areSetEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;let[c,a]=t.length>e.length?[t,e]:[e,t],p=new Set(a);for(let h=0;h<c.length;h++){let g=c[h];if(!p.has(g))return!1}return!0},r.buildElementCountMap=O,r.buildPath=(...t)=>t.reduce((e,o)=>{let c=toStr(o);return`${e}${c&&"/"+c||""}`},"").replace(/([^:\/]|^)\/{2,}/g,"$1/"),r.camelCase=Or,r.camelCasePath=t=>{let e=t.split(".").map((o,c)=>c>0?lt(o,!1):o);return e.length>1?e.join(""):t},r.capitalize=lt,r.checkCall=(t,...e)=>d(t)?t(...e):void 0,r.cleanColl=Mr,r.cleanStr=Pt,r.clearObj=kr,r.cloneArr=t=>Array.from([...m(t)&&t||x(t)&&Object.entries(t)||[]]),r.cloneFunc=Wt,r.cloneJson=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return Nr(e.message,"error"),null}},r.cloneObjWithPrototypeAndProperties=Sr,r.compareTo=kt,r.complement=t=>{let[e]=i({predicate:t},{predicate:d});return e?(...o)=>!t(...o):null},r.containsStr=(t,e,o)=>(t=!R(t)&&B(t)||t,e=!R(e)&&B(e)||e,t.indexOf(e,o)!==-1),r.convertToStrBool=br,r.debounce=(t,e=250,o=!1)=>{let c;return function(...a){if(!d(t))return null;let p=this,h=o&&!c;return clearTimeout(c),c=setTimeout(()=>{c=null,!o&&t.apply(p,a)},e),h?d(t)&&t.apply(p,a):void 0}},r.deepClone=v,r.deepEqual=Bt,r.deepFreeze=M,r.deepMerge=Ur,r.delimitString=xr,r.doIt=(...t)=>{let e=t.slice(),o=e.shift(),c=e.shift(),a=e.pop();if(!b(o)||!d(a))return[];let p=new Array(o),h=[];for(let g=0;g<p.length;g++){let _=a.call(c,g,...e);if(_===!1)break;h.push(_)}return h},r.either=(t,e,o)=>d(o)?o(t,e)&&t||e:$r(t)&&t||e,r.eitherArr=(t,e)=>m(t)?t:e,r.eitherFunc=(t,e)=>d(t)&&t||e,r.eitherObj=(t,e)=>x(t)&&t||e,r.eitherStr=(t,e)=>R(t)&&t||e,r.ensureArr=y,r.equalsNaN=q,r.everyEntry=(t,e)=>t?x(t)?d(e)?Ft(t,Object.entries,o=>o.every(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into everyEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`everyEntry expects argument obj [${t}] to be defined.`),!1),r.exists=et,r.filterObj=(t,e)=>t&&(x(t)?d(e)?ct(t,(o,c,a)=>(e(o,c)&&(a[o]=c),a),{}):(console.error(`Argument 'predicate' passed into filterObject must a function. Found: ${e}`),t):(console.error(`Object ${t} was not an object. It must be for filterObject`),t)),r.findExtrema=Ht,r.findMax=(t=[],e=Ut)=>Ht(t,(o,c)=>kt(e(o),e(c))),r.findMin=(t=[],e=Ut)=>Ht(t,(o,c)=>kt(e(c),e(o))),r.flatArr=mr,r.flatMap=(t,e)=>{let[o]=i({arr:t,mapFn:e},{arr:m,mapFn:d});return o?t.reduce((c,a)=>{let p=e(a);return m(p)?p.map(h=>c.push(h)):c.push(p),c},[]):t},r.flatUnion=(...t)=>{let e=t.pop(),o={exists:!0},c=d(e)?e:t.push(e)&&void 0;return t.reduce((a,p)=>m(p)?Cr(mr([...a,...p],o),c):a,[])},r.get=nt,r.getNearestDelimiterIndex=Ar,r.getNums=ot,r.getRegexSource=qr,r.getURLParam=t=>{var e,o,c;let[a]=i({paramKey:t},{paramKey:R});if(!a)return null;let p=typeof document<"u"?document:null,h=p==null||(e=p.location)===null||e===void 0?void 0:e.search;return R(h)&&(o=(c=Gr(h))===null||c===void 0?void 0:c[t])!==null&&o!==void 0?o:null},r.getWordEndingAt=(t,e,o=[" "])=>{let c=vt(t),a=t.length-e;return vt(Er(c,a,o))},r.getWordStartingAt=Er,r.hasDomAccess=()=>{try{return!(typeof window>"u"||!window.document||!window.document.createElement)}catch{return!1}},r.hasOwn=Tr,r.hashString=(t,e)=>{if(!R(t)||t.length==0)return 0;t=t.split("").reverse().join("");let o=0;for(let c=0;c<t.length;c++)o=(o<<5)-o+t.charCodeAt(c),o=`${Math.abs(o&o)}`;return Ct(e)?o.slice(0,e):o},r.hyphenator=t=>{if(It.hasOwnProperty(t))return It[t];let e=t.replace(rn,nn);return It[t]=en.test(e)?"-"+e:e},r.identity=Ut,r.isArr=m,r.isArrMap=t=>{if(!x(t))return!1;let e=Object.values(t);return Dt(e.length&&e.every(m))},r.isBool=pt,r.isColl=L,r.isEmail=t=>!t||!R(t)?!1:Boolean(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(t)),r.isEmpty=Pr,r.isEmptyColl=t=>m(t)?t.length===0:L(t)&&Object.getOwnPropertyNames(t).length===0,r.isEntry=Wr,r.isFloat=t=>b(t)&&t%1!=0,r.isFunc=d,r.isInt=t=>b(t)&&t%1==0,r.isLowerCase=dr,r.isNegative=t=>b(t)&&t<0,r.isNonNegative=Ct,r.isNum=b,r.isObj=x,r.isOrderable=wr,r.isPhone=t=>!t||!R(t)?!1:Boolean(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(t))&&t.replace(/\D/g,"").length<11,r.isPositive=t=>b(t)&&t>0,r.isQuoted=(t,e=on)=>R(t)&&e.some(o=>t.startsWith(o)&&t.endsWith(o)),r.isRegex=Br,r.isSame=(t,e)=>t===e?t!==0||1/t==1/e:t!=t&&e!=e,r.isStr=R,r.isStrBool=Xt,r.isUpperCase=gr,r.isUrl=t=>Boolean(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(t)),r.isUuid=t=>!t||!R(t)?!1:Boolean(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t)),r.isValidDate=t=>!isNaN((t instanceof Date&&t||new Date(t)).getTime()),r.isValidUrl=t=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?/.test(t),r.joinRegex=(...t)=>{let[e,o]=(a=>{if(m(a[0]))return[a[0],a[1]];let p=a[a.length-1],h=R(p)?p:void 0;return[h?a.splice(0,a.length-1):a,h]})(t),c=e.reduce((a,p)=>{let h=qr(p);return h?a===""?h:`${a}|${h}`:a},"");return new RegExp(`(${c})`,o)},r.jsonEqual=(t,e)=>{try{return JSON.stringify(t)===JSON.stringify(e)}catch{return!1}},r.keyMap=(t,e)=>m(t)&&t.reduce((o,c)=>{if(!R(c))return o;let a=e&&c.toUpperCase()||c;return o[a]=a,o},{})||{},r.limbo=t=>t&&d(t.then)?t.then(e=>[null,e]).catch(e=>[e,void 0]):[new Error("A promise or thenable is required as the first argument!"),null],r.logData=Nr,r.mapColl=(t,e)=>d(e)&&L(t)?Object.keys(t).map(o=>e(o,t[o],t)):m(t)?[]:{},r.mapEntries=Hr,r.mapFind=(t,e,o=et)=>{let[c]=i({coll:t,mapper:e,test:o},{coll:L,$default:d});if(c)return x(t)?((a,p,h)=>{let g=0;for(let _ in a){if(!a.hasOwnProperty(_))continue;let $=p(a[_],_,g);if(h($,_,g))return $;g++}return null})(t,e,o):((a,p,h)=>{for(let g=0;g<a.length;g++){let _=p(a[g],g,g);if(h(_,g,g))return _}return null})(t,e,o)},r.mapKeys=(t,e)=>x(t)&&d(e)?Hr(t,(o,c)=>[e(o),c]):t,r.mapObj=(t,e)=>x(t)&&d(e)&&Object.entries(t).map(([o,c])=>e(o,c))||t,r.mapString=hr,r.match=Fr,r.memorize=(t,e,o=1)=>{if(!d(t)||e&&!d(e))return console.error("Error: Expected a function",t,e);let c=function(){let a=c.cache,p=e?e.apply(this,arguments):arguments[0];if(Tr(a,p))return a[p];let h=t.apply(this,arguments);return b(o)&&Object.keys(a).length<o?a[p]=h:c.cache={[p]:h},h};return c.cache={},c.destroy=()=>{e=void 0,c.cache=void 0,c.destroy=void 0,c=void 0},c},r.mod=(t,e)=>(t%e+e)%e,r.noOp=()=>{},r.noOpObj=ut,r.noPropArr=tn,r.noPropObj=N,r.nth=t=>{if(!b(t)&&(!(t=ot(t))||(t=Nt(t),q(t))))return"";let e=t%100;if(e>=10&&e<=20)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},r.objToQuery=t=>{let e;return ct(t,(o,c,a)=>{if(!c)return a;let p=R(c)||b(c)||pt(c)?c:L(c)?m(c)?c.join(","):JSON.stringify(c):null;return p&&(a=e?`${a}&${encodeURIComponent(o)}=${encodeURIComponent(p)}`:`?${encodeURIComponent(o)}=${encodeURIComponent(p)}`,e=!0),a},"")},r.omitKeys=(t={},e=[])=>x(t)&&ct(t,(o,c,a)=>(e.indexOf(o)===-1&&(a[o]=t[o]),a),{})||{},r.omitRange=(t,e,o)=>{let[c]=i({arr:t,startIndex:e,count:o},{arr:m,$default:Ct});if(!c)return t;let a=[...t];return a.splice(e,o),a},r.parseErrorMessage=t=>R(t)&&!Pr(t)?t:x(t)?t.message:null,r.parseJSON=(t,e=!0)=>{try{return JSON.parse(t)}catch(o){return e&&console.error(o.message),null}},r.pickKeys=(t={},e=[])=>x(t)&&e.reduce((o,c)=>(c in t&&(o[c]=t[c]),o),{})||{},r.pipeline=Ft,r.plural=t=>t&&t.length&&t[t.length-1]!=="s"?t+"s":t,r.promisify=Gt,r.promisifyAll=t=>{if(!x(t))return t;zr(t);let e=Object.getPrototypeOf(t);return e&&Object.getPrototypeOf(e)!==null&&zr(e),t},r.queryToObj=Gr,r.randomArr=(t,e)=>{if(!m(t))return t;let o=e||1,c=[];for(let a=0;a<o;a++)c.push(t[Math.floor(Math.random()*t.length)]);return e?c:c[0]},r.randomizeArr=t=>!m(t)&&t||t.sort(()=>.5-Math.random()),r.reduceColl=(t,e,o)=>d(e)&&L(t)?Object.keys(t).reduce((c,a)=>e(a,t[a],t,c),o):m(t)?[]:{},r.reduceObj=ct,r.removeDot=Rr,r.repeat=(t,e,o=!1)=>{if(!e||e<=0)return[];if(!b(e))return console.error("Times argument must be a number"),[];let c=[];for(let a=0;a<e;a++){let p=d(t)?t():o?v(t):t;c.push(p)}return c},r.resetLogs=()=>{qt=void 0,st="log",G="type"},r.reverseStr=vt,r.runSeq=async(t=[],e={})=>{let[o]=i({asyncFns:t},{asyncFns:m});if(!o)return[];let{cloneResults:c=!1,returnOriginal:a=!0}=e,p=[];for(let h of t){let g=d(h)?await h(p.length,c?v(p):p):a?h:void 0;p.push(g)}return p},r.sanitize=yr,r.sanitizeCopy=t=>JSON.parse(yr(JSON.stringify(t))),r.set=zt,r.setLogs=(t,e,o)=>{qt=t,st=e||st||"log",G=o||G||"type"},r.shallowEqual=(t,e,o)=>{if(o&&(m(o)||R(o))&&(t=nt(t,o),e=nt(e,o)),t===e)return!0;if(!(t&&L(t)&&e&&L(e))||Object.keys(t).length!==Object.keys(e).length)return!1;for(let c in t)if(t[c]!==e[c])return!1;return!0},r.singular=t=>t&&t.length&&t[t.length-1]==="s"?t.slice(0,t.length-1):t,r.snakeCase=t=>xr(t,"_").toLowerCase(),r.softFalsy=$r,r.someEntry=(t,e)=>t?x(t)?d(e)?Ft(t,Object.entries,o=>o.some(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into someEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`someEntry expects argument obj [${t}] to be defined.`),!1),r.spaceJoin=(t,e)=>(e=m(e)?e:[e]).reduce((o,c)=>R(c)?`${o?o+" ":""}${c}`.trim():o,R(t)?t:""),r.splitByKeys=(t={},e)=>{if(!e)return[{},{...t}];let o=[{},{}],c=y(e);return x(t)?ct(t,(a,p,h)=>(et(c.find(g=>et(g)&&B(g)===a))?h[0][a]=t[a]:h[1][a]=t[a],h),o):o},r.strToType=Dr,r.styleCase=t=>{if(!R(t))return t;let e=Or(t);return`${e[0].toLowerCase()}${e.slice(1)}`},r.template=_r,r.throttle=(t,e=100)=>{let o=!1;return function(...c){if(!o)return o=!0,t.apply(this,c),setTimeout(()=>{o=!1},e)}},r.throttleLast=(t,e,o=100)=>{let c;return function(...a){c&&clearTimeout(c),c=setTimeout(()=>{t.apply(this,a),clearTimeout(c)},o),typeof e=="function"&&e()}},r.timedRun=async(t,...e)=>{let[o]=i({fn:t},{fn:d});if(!o)return[void 0,-1];let c=new Date;return[await t(...e),new Date-c]},r.toBool=Dt,r.toFloat=t=>t&&!q(t)&&parseFloat(b(t)&&t||ot(t))||0,r.toInt=t=>t&&!q(t)&&parseInt(b(t)&&t||ot(t))||0,r.toNum=Nt,r.toObj=(t,e,o)=>m(t)?Object.keys(t).reduce((c,a)=>(c[a]=t[a],c),{}):R(str)?(e=e||"=",o=o||"&",str.split(o).reduce((c,a)=>{let p=a.split(e);return c[p[0].trim()]=Dr(p[1].trim()),c},{})):{},r.toStr=B,r.trainCase=t=>R(t)&&t.split(/(?=[A-Z])|[\s_-]/gm).join("-").toLowerCase()||t,r.trimStringFields=t=>Object.entries(t).reduce((e,[o,c])=>(e[o]=R(c)?c.trim():c,e),t),r.typeOf=Lr,r.uniqArr=Cr,r.uniqArrByReference=Ir,r.unset=(t,e)=>Mt(t,e,"unset"),r.uuid=jr,r.validFilename=t=>t?!(/[<>:"/\\|?*\u0000-\u001F]/g.test(t)||/^(con|prn|aux|nul|com\d|lpt\d)$/i.test(t)||/^\.\.?$/.test(t)):!1,r.validate=i,r.wait=t=>new Promise(e=>setTimeout(()=>e(!0),t)),r.wordCaps=t=>R(t)?Pt(t).split(" ").map(e=>e&&lt(e)||"").join(" "):t})});var Lo={};dn(Lo,{PKInstance:()=>jo,Parkin:()=>Lt});module.exports=gn(Lo);var Vr=T(w()),F=(0,Vr.deepFreeze)({ALIAS_REF:"$$",ALIAS_WORLD_KEY:"$alias",ALIAS_REF_AT_RUNTIME:"$$:",REGEX_VARIANT:"regex",WORLD_REF:"$",WORLD_KEY:"$world",WORLD_AT_RUNTIME:"$:",EXPRESSION_VARIANT:"expression",STEP_TYPES:["given","when","then","and","but"],HOOK_TYPES:["beforeAll","afterAll","beforeEach","afterEach"],FEATURE_META:["feature","perspective","desire","reason","comments"],LOG_JEST_SPEC_ENV:"PARKIN_LOG_JEST_SPEC",SPEC_RESULT_LOG:"------- PARKIN SPEC RESULT LOG -------"});var Re=T(w());var At=T(w());var X=(r,n,s)=>{let i=r.match(n)[s];return i?i.trim():" "},P=(r,n)=>{let s=r&&r.trim()&&r.trim().toLowerCase().replace(/[\s\/\\\(\)\+=_&%\$#@!\*~`\|\?:;"'<>,.{}]/g,"-");return s?`${s}-${r.length}`:`${n}-${n.length}`},Qr=r=>{let n=r.match.toString();return n[0]==="/"&&(n=n.substr(1)),n[0]==="^"&&(n=n.substr(1)),n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n.charAt(n.length-1)==="$"&&(n=n.slice(0,-1)),n.replace(/\(\?:([^\|]+)+\|+([^\)]+)?\)/,"$1")},Yr=(r,n)=>n.reduce((s,i)=>!s||i.content===s.content?!1:(i.uuid===s.uuid&&(s.uuid=`${s.uuid}-${s.content.length}`),s),{...r}),ht=r=>r.trim().replace(/^("|')/,"").replace(/("|')$/,"");var A=T(w());var Zr=T(w()),it=/\w*\([^)]*?\)/,dt=/\s*\S*\/\S*\s*/,H=/\s*{(.*?)}\s*/,te=(0,Zr.joinRegex)(H,it,"g"),Kt=/(.*)/,gt=/{|}/g,xt=/"[^"]+"/,Rt=/'[^']+'/,Ot=/-?[0-9]+[.][0-9]+/,yt=/-?[0-9]+/,re=/^["]?\$world\.\S+["]?/,ee=/^\$world\./,ne=/(\$:world|\$world)+\.[^"'\s]*/gm,oe=/^["]?\$\$\S+["]?/,se=/^\$\$/,ce=/(\$\$:\w+|\$\$\w+)[^"'\s]*/gm;var ie=r=>()=>{throw new Error(`Test method ${r} does not exist on the global scope.
Please ensure ${r} exists before calling the run method!
`)},ae=()=>{throw new Error("Runner class constructor requires an instance of the Steps class")};var ue=()=>{throw new Error("Runner class requires feature text when calling the run method")},le=r=>{throw new ReferenceError(r)},pe=()=>{throw new Error(`Cannot register param type "${name}". It already exists!`)},me=r=>{throw new Error("Assemble feature requires an object matching the feature model spec!",r)},fe=(r,n)=>{throw new Error(`Can not replace ${r} with value from $world, it does not exist on the world object`,n,r)},he=(r,n)=>{throw new Error([`Expected client hook type to be one of ', ${r}.`,`Found: ${n}`].join(`
`))},de=(r,n)=>{throw console.error(`Error replacing $world value in feature text. Current match was ${n}`),r},ge=(r,n)=>{throw console.error(`Error replacing $$alias ( $world.$alias ) in feature text. Current match was ${n}`),r};var{WORLD_KEY:xn,ALIAS_WORLD_KEY:Rn,ALIAS_REF:On}=F,K=(r,n)=>(s,i)=>{let u=s.match(re),l=s.match(oe);if(!(0,A.isObj)(i)||!u&&!l)return Vt(r(s),n);let f=u?(0,A.get)(i,ht(s).replace(`${xn}.`,"")):(0,A.get)(i,ht(s).replace(`${On}`,`${Rn}.`));return(0,A.exists)(f)?Vt(f,n):u?fe(s,i):Vt(r(s),n)},Vt=(r,n)=>typeof r===n?r:null,k={name:"",regex:"",type:"string",useForSnippets:!0,preferForRegexpMatch:!1,transformer:K(r=>r,"string")},U={any:{...k,name:"any",regex:Kt},word:{...k,name:"word",regex:Kt,transformer:K(r=>(0,A.isQuoted)(r)?void 0:(0,A.toStr)(r),k.type)},float:{...k,name:"float",type:"number",regex:Ot,transformer:K(r=>{let n=parseFloat(r);return(0,A.equalsNaN)(n)?void 0:n},"number")},int:{...k,name:"int",type:"number",regex:yt,transformer:K(r=>{let n=parseInt(r);return(0,A.equalsNaN)(n)||r.includes(".")?void 0:n},"number")},string:{...k,name:"string",regex:(0,A.joinRegex)(xt,Rt),transformer:K(r=>(0,A.isQuoted)(r)?ht(r):void 0,k.type)}},V=()=>U,_t=(r=A.noOpObj,n=r.name)=>U[n]?pe(n):(U[n]={...k,...r},U[n].transformer=K(U[n].transformer,U[n].type),U),xe=(r,n,s)=>r.map((i,u)=>{let l=n[u]||U.any;return(0,A.checkCall)(l.transformer,i,s)}).filter(A.exists);var Q=(r,n)=>{let s=n.match(new RegExp(r.match));return s?{definition:r,match:s.slice(1,s.length).filter(Boolean)}:At.noOpObj},Yt=r=>{let n=r.split(/(\(|\))/),[s,,i,,u]=n;return s===""&&u===""?r+"?":s===""?`(${i}|${i}${u})`:u===""?`(${s}|${s}${i})`:`(${s}${u}|${s}${i}${u})`},yn=r=>{let n=r.input;return(0,At.getWordEndingAt)(n,r.index)+r[0]},_n=r=>{let n=yn(r);return Yt(n)},Zt=r=>{let n=V();return(n[r]||n.any).regex.source},tr=r=>`(${r.trim().replace(/\//g,"|")})`,An=(r,n)=>{let[s,i]=n;switch(r){case"parameter":return new RegExp(Zt(i));case"optional":return new RegExp(_n(n));case"alternate":return new RegExp(tr(s));default:return null}},Qt=(r,n="other")=>{let s=r[0],i=s.trimStart(),u=s.length-i.length;return{text:s.trim(),input:r.input,index:r.index+u,regex:An(n,r),type:n,...n==="parameter"&&{paramType:s.trim().replace(gt,"")}}},Y=r=>{let n=[...r.matchAll(new RegExp(H,"gi"))].map(l=>Qt(l,"parameter")),s=[...r.matchAll(new RegExp(it,"gi"))].map(l=>Qt(l,"optional")),i=[...r.matchAll(new RegExp(dt,"gi"))].map(l=>Qt(l,"alternate"));return[...n,...s,...i].sort((l,f)=>l.index-f.index)};var En=(0,Re.joinRegex)(yt,Ot,H,xt,Rt,"g"),Oe=(r,n)=>{let s=Y(n.match),i=[],u,l=0;for(;(u=En.exec(r))!==null;){let[f,m,...O]=u,E=O.pop(),x=s[l],y=f.trimStart(),d=f.length-y.length;i.push({match:f.trim(),defIndex:x==null?void 0:x.index,index:u.index+d,type:E||(x==null?void 0:x.paramType)||"any"}),l++}return i};var we=T(w());var I=T(w()),rr=Boolean(typeof window<"u"),ye=Boolean(typeof global<"u"),bn=Boolean(typeof module=="object"),$n=Boolean(typeof require=="function"),er=Boolean(ye&&typeof global.jasmine<"u"),_e=()=>er?(0,I.checkCall)(()=>global.jasmine):{getEnv:()=>I.noOpObj},Ae=()=>bn?(0,I.checkCall)(()=>module):{exports:{}},Ee=()=>$n?(0,I.checkCall)(()=>require):I.noOp,be=()=>{try{return rr?(0,I.checkCall)(()=>window):ye?(0,I.checkCall)(()=>global):I.noOpObj}catch{return I.noOpObj}};var Z=T(w());var wn=r=>rr?r.replace(/[|\\[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"):r.replace(/[|\\[\]^$+*?.]/g,"\\$&"),$e=(r,n,s)=>{if(!n.test(r))return r;let i=r;return r.replace(n,(...u)=>{let l=u[0].trim(),[f,...m]=i.split(l),O=(0,Z.isFunc)(s)?s(...u):s;i=`${f}${O}${m.join(l)}`}),i},Tn=r=>{let n=V(),s=[];return{regex:$e(r,te,(u,...l)=>{let f=u.trim().replace(gt,""),m=u.match(H),O=u.match(it);return m&&s.push(n[f]||n.any),m?Zt(f):O?Yt(u):u}),transformers:s}},Sn=r=>{let n=[];return{regex:$e(r,new RegExp(dt,"g"),tr),altIndexes:n}},jn=r=>{let n=r;return r.startsWith("^")||(n="^"+n),r.endsWith("$")||(n+="$"),{regex:n}},nr=(r,n,s)=>{let i=Y(n),u=i.filter(f=>f.type==="parameter").length,l=i.reduce((f,m)=>{let{params:O,textIndex:E,wordMatchIndex:x}=f,y=r.substring(E),d=m.paramType==="word",M=y.match(m.regex),ut={0:s[x],index:y.indexOf(s[x])},N=d?ut:M;return N?(m.type==="parameter"&&N&&O.push(N[0]),{params:O,textIndex:E+(N&&N.index+N[0].length),wordMatchIndex:x+(d&&1)}):f},{params:[],textIndex:0,wordMatchIndex:0});return u===l.params.length?l.params:null},or=(r,n)=>{let s=wn(r.match),{regex:i}=Sn(s),{transformers:u,regex:l}=Tn(i),{regex:f}=jn(l);return{found:Q({...r,match:f},n),escaped:s,regexAlts:i,transformers:u,regexAnchors:f,regexConverted:l}},Et=(r,n,s)=>{if(r.match===n)return{definition:r,match:[]};let{found:i,transformers:u}=or(r,n);if(!i||!i.definition||!i.match)return Z.noOpObj;let l=nr(n,r.match,i.match);if(!l)return Z.noOpObj;let f=xe(l,u,s);return f.length!==l.length?Z.noOpObj:{definition:r,match:f}};var{REGEX_VARIANT:Ln}=F,bt=class{constructor(){this.find=sr;this.regex=Q;this.parts=Y;this.types=V;this.stepTokens=Oe;this.extract=nr;this.expression=Et;this.expressionFind=or;this.register=_t}},sr=(r,n,s)=>r.reduce((i,u)=>i.match||!u.match?i:u.variant!==Ln?Et(u,n,s):Q(u,n),we.noOpObj);var D=T(w());var{REGEX_VARIANT:Te,EXPRESSION_VARIANT:Fn,STEP_TYPES:Pn}=F,In=r=>{let n=r.variant===Te?r.match.toString():`"${r.match}"`;return`${(0,D.capitalize)(r.type)}(${n}, ${r.method.toString()})`},Cn=function(r,n,s,i,u=D.noOpObj){let l={type:n,meta:u,match:s,method:i,tokens:[],variant:s.toString().indexOf("/")===0?Te:Fn};l.name=Qr(l),l.uuid=P(`${n}-${l.name}`),l.content=In(l);let f=this.list(),m=Yr(l,f);return m&&this[r].push(m),m},Mn=(r,n,s)=>(...i)=>{let u=r[n](...i);return s[n].push(u),u},vn=function(r){let n=this.types.map(i=>(0,D.capitalize)(i)),s=n.reduce((i,u)=>(i[u]=[],i),{});return(0,D.eitherArr)(r,[r]).map(i=>{Function(`return (global, require, module, ${n.join(",")}) => {
          return (function(global) { ${i} }).call(global, global)
        }`)()(be(),Ee(),Ae(),...n.map(u=>Mn(this,u,s)))}),s},Xn=r=>r.types.reduce((n,s)=>n.concat(r[`_${s}`]),[]),$t=class{types=Pn;constructor(n){this._world=n||{};let s=this;this.types.map(i=>{let u=`_${i}`;this[u]=[],this[(0,D.capitalize)(i)]=(l,f,m)=>s.register(u,i,l,f,m)})}list=()=>Xn(this);typeList=()=>this.types.reduce((n,s)=>{let i=`_${s}`;return n[i]=[...this[i]],n},{});match=n=>{let s=this.list(),i=sr(s,n,this._world);return!i.match||!i.definition?!1:(i.match.push(this._world),i)};resolve=n=>{let s=this.match(n);return s?s.definition.method(...s.match):le(`Matching definition could not be found for step: "${n}"`)};register=(...n)=>(0,D.isStr)(n[0])?Cn.apply(this,n):vn.apply(this,n);clear=()=>{this.types.map(n=>this[`_${n}`]=[])}};var tt=T(w());var{HOOK_TYPES:Se}=F,wt=class{types=Se;instance=void 0;constructor(n,s){this._registeredHooks={},this.instance=s,this.types.map(i=>{this[i]=u=>{(0,tt.isFunc)(u)&&(this._registeredHooks[i]=this._registeredHooks[i]||[],this._registeredHooks[i].push(u))}})}getRegistered=n=>{let s=this.types.includes(n)?this._registeredHooks[n]||tt.noPropArr:he(Se.join(", "),n);return s.length?async()=>s.reduce(async(i,u)=>(await i,await u(this.instance)),Promise.resolve()):tt.noOp}};var Dn=/^\s*Given (.*)$/,Nn=/^\s*When(.*)$/,kn=/^\s*Then (.*)$/,Un=/^\s*And (.*)$/,Wn=/^\s*But (.*)$/,Hn=/^\s*\* (.*)$/,zn=/^\s*?"""\s*?/;var Bn=/^\s*?```\s*?/;var je=/^\s*?\|/;var qn=[{regex:Dn,type:"given"},{regex:Nn,type:"when"},{regex:kn,type:"then"},{regex:Un,type:"and"},{regex:Wn,type:"but"},{regex:Hn,type:"and"}],Gn=(r,n,s,i)=>{if(!je.test(s))return r;let u;return r.table={index:i,content:n.reduce((l,f)=>(u=u||!je.test(f),!u&&l.push(f.split("|").reduce((m,O)=>{let E=O.trim();return E&&m.push(E),m},[])),l),[])},r},Jn=(r,n,s,i)=>{let u=zn.test(s)&&'"""';if(u=u||Bn.test(s)&&"```",!u)return r;let l=s.split(u)[0],f=new Array(l.length).fill("\\s").join(""),m=new RegExp(`^${f}`);return r.doc={index:i,whiteSpace:l,type:u==='"""'?"quote":"tick",content:n.split(u).slice(1).shift().trim().split(`
`).reduce((O,E)=>(O.push(E.replace(m,"").trim()),O),[]).join(`
`)},r},Kn=(r,n,s,i)=>{let u={type:r,index:i,step:n,uuid:P(`${r}-${n}`)},l=i+1,f=s[l],m=s.slice(l);return u=Gn(u,m,f,l),u=Jn(u,m.join(`
`),f,l),u},Le=(r,n,s,i)=>qn.reduce((u,l)=>{if(u)return u;let f=l.regex.test(s);return f&&r.steps.push(Kn(l.type,X(s,l.regex,1),n,i)),f},!1);var Xe=T(w());var rt=T(w());var{ALIAS_REF:Vn,WORLD_REF:Qn,ALIAS_WORLD_KEY:Yn,WORLD_AT_RUNTIME:Fe,ALIAS_REF_AT_RUNTIME:Pe}=F,Ie=(r,n,s)=>{let i=(0,rt.get)(n,s);return(0,rt.isFunc)(i)?i(n,s):(0,rt.exists)(i)?i:r},Zn=(r,n)=>{let s;try{return r.replace(ce,i=>{s=i;let u=i.trim();return u.indexOf(Pe)===0?u.replace(Pe,`$${Vn}`):Ie(i,n,u.replace(se,`${Yn}.`))})}catch(i){ge(i,s)}},to=(r,n)=>{let s;try{return r.replace(ne,i=>{s=i;let u=i.trim();return u.indexOf(Fe)===0?u.replace(Fe,Qn):Ie(i,n,u.replace(ee,""))})}catch(i){de(i,s)}},Ce=(r,n)=>to(Zn(r,n),n);var ro=/\r?\n/g,Me=/^\s*@(.*)$/,ve=/^\s*#(.*)$/,cr=/^\s*Feature:(.*)$/,ir=/^\s*Rule:(.*)$/,eo=/^\s*As (.*)$/,no=/^\s*I want (.*)$/,oo=/^\s*So that (.*)$/,so=/^\s*In order (.*)$/,ar=/^\s*Scenario:(.*)$/,ur=/^\s*Example:(.*)$/,De=/^\s*Background:(.*)$/,co=[{regex:eo,key:"perspective"},{regex:no,key:"desire"},{regex:oo,key:"reason"},{regex:so,key:"reason"}],Ne=(r,n,s)=>({index:s,content:n,feature:r,tags:[],rules:[],reason:[],comments:[],scenarios:[],...r&&{uuid:P(r,s)}}),ke=(r,n)=>({index:n,rule:r,tags:[],scenarios:[],...r&&{uuid:P(r,n)}}),Ue=(r,n)=>({index:n,scenario:r,tags:[],steps:[],...r&&{uuid:P(r,n)}}),We=(r,n)=>({index:n,steps:[],background:r,...r&&{uuid:P(r,n)}}),io=(r,n,s)=>{n&&r.reason.push({content:n,index:s})},ao=(r,n,s)=>{let i=!1;return co.reduce((u,l)=>{if(u)return u;let f=l.regex.test(n);return!i&&f&&(i=!0),f&&(l.key==="reason"?io(r,X(n,l.regex,0),s):r[l.key]={content:X(n,l.regex,0),index:s})},!1),i},uo=(r,n,s,i)=>{if(!Me.test(s))return!1;let u=r.background?n:r,l=X(s,Me,0);return u.tags=(u.tags||[]).concat(l.split(" ")),!0},lo=(r,n,s)=>{if(!ve.test(n))return!1;let i=n.match(ve)[0];return r.comments.push({content:i,index:s}),!0},po=(r,n,s,i,u)=>{if(!cr.test(s))return n;let l=X(s,cr,1);if(!n.feature)return n.feature=l,n.index||(n.index=u),n.uuid||(n.uuid=P(n.feature,u)),!r.includes(n)&&r.push(n),n;let f=Ne(l,i,u);return r.push(f),f},mo=(r,n,s,i)=>{if(!ir.test(s))return n;let u=X(s,ir,1);return n.rule?n=ke(u,i):n.rule=u,!n.index&&(n.index=i),!n.uuid&&(n.uuid=P(n.rule,i)),!r.rules.includes(n)&&r.rules.push(n),n},fo=(r,n,s,i,u)=>{let l=ar.test(i);if(!l&&!ur.test(i))return s;let f=l&&X(i,ar,1);f=f||X(i,ur,1),s.scenario?s=Ue(f,u):s.scenario=f,!s.index&&(s.index=u),!s.uuid&&(s.uuid=P(s.scenario,u));let m=n.uuid?n:r;return!m.scenarios.includes(s)&&m.scenarios.push(s),s},ho=(r,n,s,i,u)=>{if(!De.test(i))return s;let l=n.uuid?n:r,f=`${l.uuid}-background`;return s.background?s=We(f,u):s.background=f||"",!s.index&&(s.index=u),!s.uuid&&(s.uuid=P(s.background,u)),l.background=s,s},go=(r,n,s,i,u,l)=>ar.test(l)||ur.test(l)?i:cr.test(l)?n:ir.test(l)?s:De.test(l)?u:r,Tt=function(r,n){n=n||this&&this.world||Xe.noOpObj;let s=[],u=Ce((r||"").toString(),n).split(ro),l=ke(!1),f=Ue(!1),m=We(!1),O=Ne(!1,r),E=O;return u.reduce((x,y,d)=>(O=po(x,O,y,r,d),lo(O,y,d)||ao(O,y,d)||(l=mo(O,l,y,d),f=fo(O,l,f,y,d),m=ho(O,l,m,y,d),!E.feature&&Le(E,u,y,d))||(E=go(E,O,l,f,m,y),uo(E,O,y,d)),x),s)};var He=function(r){return this.steps.register([r])};var at=T(w());var{SPEC_RESULT_LOG:ze,LOG_JEST_SPEC_ENV:xo}=F,St=r=>{let n=new Date().getTime();(0,at.get)(process,`env.${xo}`)&&process.stdout.write([ze,JSON.stringify({...r,timestamp:n}),ze].join(""))},Be=r=>{let n=(0,at.get)(r,"description"),s=n?n.startsWith("Scenario >")?"Scenario":n.startsWith("Background >")?"Background":n.startsWith("Rule >")?"Rule":"Feature":"Feature";return{type:s.toLowerCase(),...s!=="Feature"&&{description:n.replace(`${s} >`,`${s}:`)}}},W=(r,n)=>n?at.noOp:global[r]||ie(r),Ro=r=>{let n=[],s=r.describe;return r.describe=(...i)=>{let u=s.apply(null,i);return n.push(u),u},{suiteStarted:i=>{St({...i,...Be(i),action:"start"})},specStarted:i=>{St({...i,type:"step",action:"start"})},specDone:i=>{if(St({...i,type:"step",action:"end"}),i.status!=="failed")return;let u=n.find(l=>l.children.find(f=>f.result===i));u&&u.children.map(l=>l.disable())},suiteDone:i=>{St({...i,...Be(i),action:"end"})}}},qe=r=>{if(!er)return;let n=_e().getEnv();n&&n.describe&&n.addReporter(Ro(n,r))};var j=T(w()),lr=(r,n)=>`${(0,j.capitalize)(n)} > ${r}`,Ke=(r,n)=>(0,j.isStr)(r)?Tt(r,n):(0,j.isObj)(r)?[r]:(0,j.isArr)(r)?r.reduce((s,i)=>s.concat(Ke(i,n)),[]):ue(),Oo=async(r,n,s)=>{W("test",s)(`${(0,j.capitalize)(n.type)} ${n.step}`,async()=>await r.resolve(n.step))},Ge=(r,n,s,i)=>{let u=W("describe",i),l=[];return u(n,()=>{let f=r.steps.map(m=>Oo(s,m,i));Promise.all(f)}),l},Ve=(r,n,s,i)=>(s&&Ge(s,lr(n.scenario,"Background"),r,i),Ge(n,lr(n.scenario,"Scenario"),r,i)),yo=(r,n,s,i)=>{let u=[];return describe(`Rule > ${n.rule}`,()=>{u=n.scenarios.map(l=>Ve(r,l,s||n.background,i)),Promise.all(u)}),u},_o=r=>(0,j.isStr)(r)&&r.match(/[@]\w*/g),Je=(r="",n=[],s={})=>{let{name:i,tags:u}=s,l=(0,j.isStr)(u)?_o(u):(0,j.eitherArr)(u,[]),f=!i||r.includes(i),m=!l.length||l.every(O=>n.includes(O));return f&&m},Ao=(r,n={})=>r.reduce((s,i)=>{if(Je(i.feature,i.tags,n))return s.push(i),s;let l=i.scenarios.filter(f=>Je(f.scenario,[...f.tags||[],...i.tags||[]],n));return l.length&&s.push({...i,scenarios:l}),s},[]),jt=class{constructor(n,s,i){!n&&ae(),!s&&throwMissingHooks(),this.steps=n,this.hooks=s,this._world=i}getFeatures=(n,s)=>{let i=Ke(n,this._world);return Ao(i,s)};run=async(n,s=j.noOpObj)=>{let i=this.run.PARKIN_TEST_MODE;qe(i);let u=W("describe",i),l=W("beforeAll",i),f=W("afterAll",i),m=W("beforeEach",i),O=W("afterEach",i),E=this.getFeatures(n,s);if(!E.length)return!1;let x=await E.map(async y=>{let d=[];return l(this.hooks.getRegistered("beforeAll")),f(this.hooks.getRegistered("afterAll")),m(this.hooks.getRegistered("beforeEach")),O(this.hooks.getRegistered("afterEach")),u(lr(y.feature,"Feature"),()=>{d=y.rules.map(M=>yo(this.steps,M,y.background,i)),d.concat(y.scenarios.map(M=>Ve(this.steps,M,y.background,i))),Promise.all(d)}),d});return await Promise.all(x),!0}};var S=T(w()),{FEATURE_META:Eo}=F,z=(r,n,s)=>{(0,S.exists)(s)?(0,S.exists)(r[s])?r.splice(s,0,n):r[s]=n:r.push(n)},Qe=(r,n,s="")=>{(0,S.isArr)(n)&&n.length&&z(r,`${s}${n.join(" ")}`)},bo=(r,n)=>{Eo.map(s=>{switch(s){case"feature":z(r,`Feature: ${n[s]}`,n.index);break;case"comments":(0,S.isArr)(n[s])&&n[s].map(i=>z(r,i.content,i.index));break;case"reason":(0,S.isArr)(n[s])&&n[s].map(i=>z(r,`  ${i.content}`,i.index));break;case"desire":case"perspective":n[s]&&z(r,`  ${n[s].content}`,n[s].index);break}})},$o=(r,n)=>{(0,S.isArr)(n.steps)&&n.steps.length&&n.steps.map(s=>z(r,`    ${(0,S.capitalize)(s.type)} ${s.step}`,s.index))},wo=(r,n)=>{n.scenarios&&n.scenarios.map(s=>{Qe(r,s.tags,"  "),z(r,`  Scenario: ${s.scenario}`,s.index),$o(r,s)})},To=(r,n,s)=>{let i=r[s+1],u=r[s-1],l=(0,S.exists)(i)?i:u;if(!l)return`${n}
`;let f=n.split("#").pop();return`${Array(l.length-l.trimStart().length).join(" ")} # ${f}
`},So=r=>Array.from(r,(n,s)=>(0,S.exists)(n)?n.startsWith("#")?To(r,n,s):`${n}
`:`
`).join("").trim(),Ye=r=>(0,S.eitherArr)(r,[r]).map(n=>{let s=[];return!(0,S.isObj)(n)&&me(n),Qe(s,n.tags),bo(s,n),wo(s,n),So(s)});var Ze={feature:Ye};var C=T(w()),Lt=class{constructor(n,s){(0,C.isObj)(n)&&this.init(n,s)}#t=!1;init=(n=C.noOpObj,s)=>{if(this.#t)return console.warn("This instance of parkin has already been initialized!");(0,C.isObj)(n.$alias)||(n.$alias={}),this.#t=!0,this.world=n,this.steps=new $t(this.world),this.hooks=new wt(this.world),this.runner=new jt(this.steps,this.hooks,this.world),this.run=this.runner.run,this.parse={feature:Tt.bind(this),definition:He.bind(this)},this.assemble=Ze,this.paramTypes={register:_t},this.matcher=new bt,(0,C.isObj)(s)&&this.registerSteps(s),this.steps.types.map(i=>{this[(0,C.capitalize)(i)]=(u,l,f)=>this.steps.register(`_${i}`,i,u,l,f)})};registerSteps=n=>{Object.entries(n).map((s,i)=>Object.entries(i).map((u,l)=>this.steps[(0,C.capitalize)(s)](u,...(0,C.eitherArr)(l,[l]))))}},jo=new Lt;0&&(module.exports={PKInstance,Parkin});
//# sourceMappingURL=index.js.map
