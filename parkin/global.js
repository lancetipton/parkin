var pn=Object.create;var ft=Object.defineProperty;var mn=Object.getOwnPropertyDescriptor;var fn=Object.getOwnPropertyNames;var hn=Object.getPrototypeOf,dn=Object.prototype.hasOwnProperty;var gn=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),xn=(r,n)=>{for(var s in n)ft(r,s,{get:n[s],enumerable:!0})},Jr=(r,n,s,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of fn(n))!dn.call(r,u)&&u!==s&&ft(r,u,{get:()=>n[u],enumerable:!(i=mn(n,u))||i.enumerable});return r};var T=(r,n,s)=>(s=r!=null?pn(hn(r)):{},Jr(n||!r||!r.__esModule?ft(s,"default",{value:r,enumerable:!0}):s,r)),Rn=r=>Jr(ft({},"__esModule",{value:!0}),r);var w=gn((ht,Vr)=>{(function(r,n){typeof ht=="object"&&typeof Vr<"u"?n(ht):typeof define=="function"&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).jsutils={})})(ht,function(r){"use strict";let n={SHOULD_LOG:!0,SHOULD_THROW:!1,LOG_PREFIX:null},s=()=>!0,i=(t,e={},o={})=>{let{logs:c=n.SHOULD_LOG,throws:a=n.SHOULD_THROW,prefix:p=n.LOG_PREFIX}=o,h=Object.entries(t).map(([$,K])=>u($,K,e[$]||e.$default||s)),{success:g,cases:_}=h.reduce(($,K)=>l($,K,{logs:c,throws:a,prefix:p}),{success:!0,cases:{}});return[g,_]};i.setOptions=({logs:t,throws:e,prefix:o})=>{t!==void 0&&(n.SHOULD_LOG=t),e!==void 0&&(n.SHOULD_THROW=e),o!==void 0&&(n.LOG_PREFIX=o)},i.resetOptions=()=>{n.SHOULD_LOG=!0,n.SHOULD_THROW=!1,n.LOG_PREFIX=null};let u=(t,e,o)=>{let c=o(e),a=!o.name||o.name===t||o.name==="$default"?o.toString():o.name;return{success:c,key:t,value:e,validator:o,reason:c?null:[`Argument "${t}" with value `,e,` failed validator: ${a}.`]}},l=(t,e,{logs:o,throws:c,prefix:a})=>(!e.success&&f(e,o,c,a),{success:t.success&&e.success,cases:{...t.cases,[e.key]:e}}),f=(t,e,o,c)=>{let a=c?[c,...t.reason]:t.reason;if(o)throw new Error(a.join());e&&console.error(...a)},m=t=>Array.isArray(t),O=t=>{let e=new Map;for(let c=0;c<t.length;c++){var o;let a=t[c],p=(o=e.get(a))!==null&&o!==void 0?o:0;e.set(a,p+1)}return e},E=(t,e)=>{if(t.size!==e.size)return!1;for(let[o,c]of t)if(e.get(o)!==c)return!1;return!0},x=t=>typeof t=="object"&&!Array.isArray(t)&&t!==null,y=t=>m(t)?t:[t],d=t=>typeof t=="function",v=t=>(Object.freeze(t),Object.getOwnPropertyNames(t).map(e=>{t.hasOwnProperty(e)&&t[e]!==null&&(typeof t[e]=="object"||d(t[e]))&&!Object.isFrozen(t[e])&&v(t[e])}),t),lt=Object.freeze({}),N=v({content:{}}),en=v([]),et=t=>t==t&&t!=null,mr=(t,e,o)=>{for(let c=0;c<t.length;c++){let a=t[c];m(a)?mr(a,e,o):o.exists&&!et(a)||o.truthy&&!a||e.push(a)}return o.mutate?(Object.assign(t,e).splice(e.length),t):e},fr=(t,e)=>mr(t,[],x(e)?e:lt),hr=(t,e)=>{if(m(e)){let[o,...c]=e;return o(t,...c)}return d(e)?e(t):(console.error("Pipeline expected either a function or an array (for function expressions). Found "+typeof e),t)},Ft=(t,...e)=>e.reduce((o,c)=>hr(o,c),t),R=t=>typeof t=="string",dr=(t,e)=>{if(!R(t)||!d(e))return t;let o="";for(let c of t)o+=e(c);return o},gr=t=>t===t.toLowerCase(),xr=t=>t===t.toUpperCase(),Rr=(t,e,o=["-","_"," "])=>{if(!R(t))return t;let c=p=>o.some(h=>h===p),a="_";return dr(t,p=>c(p)?(a=e,e):xr(p)&&gr(a)&&!c(a)?(a=p,e+p):(a=p,p))},pt=(t,e=!0)=>{if(!R(t)||!t[0])return t;let o=e?t.slice(1).toLowerCase():t.slice(1);return`${t[0].toUpperCase()}${o}`},Or=t=>{let e=t.indexOf(".")===0?t.slice(1):t;return e.indexOf(".")===e.length-1?e.slice(0,-1):e},It=t=>t&&Or(t).replace(/[-_]/gm," ")||t,yr=(t,e)=>t&&It(t).split(/[\s_-]/gm).reduce((o,c,a)=>c?o+=(a>0||e)&&pt(c)||c.toLowerCase():o,"")||t,z=t=>t==null?"":R(t)?t:JSON.stringify(t),nn=/[A-Z]/g,on=/^ms-/,Ct={},sn=t=>"-"+t.toLowerCase(),q=t=>typeof t=="number"&&t!=t,A=t=>typeof t=="number"&&!q(t),vt=t=>A(t)&&t>=0,_r=t=>R(t)&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||t,L=t=>typeof t=="object"&&t!==null,Mt=(t,e,o,c)=>{let a=t;if(!L(t)||!t||!e)return o!=="set"&&c||void 0;let p=m(e)?Array.from(e):e.split("."),h=p.pop(),g,_;for(;g=p.shift();){let $=t[g];if(L($)||d($)?t=$:(o==="set"?t[g]={}:_=!0,t=t[g]),_)return c}return o==="get"?h in t?t[h]:c:o==="unset"?delete t[h]:(t[h]=c)&&a||a},nt=(t,e,o)=>Mt(t,e,"get",o),br=(t,e,o="")=>{e=L(e)&&e||{};let c=br.regex||/\${(.*?)\}/g;return R(t)?t.replace(c,(a,p)=>{let h=(p||a.substr(2,a.length-3)).trim(),g=nt(e,h,o);return d(g)?g(e,h,o):g}):console.error("template requires a string as the first argument")||t},cn=['"',"'"],Xt=t=>{if(!R(t))return;let e="";for(let o of t)e=o+e;return e},Er=(t,e,o)=>o.map(c=>t.indexOf(c,e)).sort().find(c=>c>=0),Ar=(t,e,o=[" "])=>{let c=Er(t,e,o);return t.substring(e,c===-1?t.length:c)},mt=t=>typeof t=="boolean",Dt=t=>t==="false"||t==="true",$r=t=>mt(t)?z(t):t&&t!=="false"&&t!=="0"?"true":"false",wr=t=>Boolean(t||t===""||t===0),Nt=t=>Dt(t)?t==="true":$r(t)==="true",ot=t=>z(t).replace(/([^.\d])/gm,""),kt=t=>A(t)?t:t&&!q(t)&&Number(ot(t))||0,Tr=t=>R(t)||A(t)||mt(t),Ut=(t,e)=>{let[o]=i({x:t,y:e},{$default:Tr});return o?R(t)?t.localeCompare(e):t-e:null},Wt=t=>t,Sr=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Ht=t=>{let e=function(...o){return t instanceof e||nt(t.prototype,"constructor.name")?new t(...o):t.apply(t,o)};for(let o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return Object.defineProperty(e,"name",{value:t.name,configurable:!0}),e.toString=()=>t.toString(),e},M=(t,e=new WeakMap)=>{if(Object(t)!==t)return t;if(t instanceof Set)return new Set(t);if(e.has(t))return e.get(t);if(m(t))return t.map(c=>M(c));if(d(t))return Ht(t);let o=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t.constructor?null:Object.create(null);return o===null?jr(t):(e.set(t,o),t instanceof Map?Array.from(t,([c,a])=>o.set(c,M(a,e))):Object.assign(o,...Object.keys(t).map(c=>({[c]:M(t[c],e)}))))},jr=t=>{if(!t)return t;let e=Object.getPrototypeOf(t),o=Object.getOwnPropertyDescriptors(t);for(let[a,p]of Object.entries(o))p.value&&(o[a].value=M(p.value));let c=Object.create(e,o);return Object.isFrozen(t)&&Object.freeze(c),Object.isSealed(t)&&Object.seal(c),c},Lr=t=>t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,Lr),Pr=t=>Object.prototype.toString.call(t).slice(8,-1),Fr=(t,...e)=>{if(!e.length)return null;for(let o of e){if(!m(o)){console.error(`Matching case must be an entry (a 2-element array). Found: ${Pr(o)}`,o);break}let[c,a]=o;if(d(c)&&c(t)||c===t)return a}return null};Fr.default=()=>!0;let Ir=t=>x(t)?Object.keys(t).length===0:m(t)?t.length===0:R(t)?t.trim().length===0:!!A(t)&&t<1,Bt=(t,e)=>{let[o]=i({arr:t,comparator:e},{arr:m,$default:d});return o&&t.length?t.reduce((c,a)=>e(c,a)>0?c:a):null},Cr=t=>m(t)?t.filter((e,o,c)=>c.indexOf(e)==o):t,vr=(t,e)=>{if(!e)return Cr(t);let{unique:o}=t.reduce((c,a)=>{let p=e(a);return!c.set.has(p)&&c.unique.push(a),c.set.add(p),c},{unique:[],set:new Set});return o},Mr=(t,e=!0)=>L(t)?Object.keys(t).reduce((o,c)=>{let a=t[c];return a==null||(o[c]=e&&L(a)?Mr(a):a),o},x(t)&&{}||[]):console.error("cleanColl requires a collection as the first argument")||t,zt=(t,e,o)=>Mt(t,e,"set",o),Xr=Array.isArray,Dr=Object.keys,an=Object.prototype.hasOwnProperty,qt=(t,e)=>{if(t===e)return!0;if(!t||!e||typeof t!="object"||typeof e!="object")return t!=t&&e!=e;let o=Xr(t),c=Xr(e),a,p,h;if(o&&c){if(p=t.length,p!=e.length)return!1;for(a=p;a--!=0;)if(!qt(t[a],e[a]))return!1;return!0}if(o!=c)return!1;let g=t instanceof Date,_=e instanceof Date;if(g!=_)return!1;if(g&&_)return t.getTime()==e.getTime();let $=t instanceof RegExp,K=e instanceof RegExp;if($!=K)return!1;if($&&K)return t.toString()==e.toString();let Jt=Dr(t);if(p=Jt.length,p!==Dr(e).length)return!1;for(a=p;a--!=0;)if(!an.call(e,Jt[a]))return!1;for(a=p;a--!=0;)if(h=Jt[a],!qt(t[h],e[h]))return!1;return!0},Nr=t=>t&&R(t)?Dt(t)?Nt(t):A(t)?kt(t):(()=>{try{return JSON.parse(t)}catch{return t}})():t,Gt,st="dir",G="type",un=["error","info","log","dir","warn"],kr=(...t)=>{if(!t.length)return;let e=t.length===1?st:t.pop();(Gt||e==="error")&&(typeof t[0]=="string"&&(G==="type"?t[0]=`[ ${e.toUpperCase()} ] ${t[0]}`:G&&(t[0]=`${G} ${t[0]}`)),un.indexOf(e)!==-1?console[e](...t):console[st](...t,e))},Ur=(t,e)=>{t&&Object.entries(t).map(([o,c])=>{e&&e.indexOf(o)!==-1||(typeof c=="object"&&Ur(c),t[o]=void 0,delete t[o])})},Wr=(...t)=>t.reduce((e,o)=>{let c=M(o);return m(c)?[...m(e)&&e||[],...c]:x(c)?Object.entries(c).reduce((a,[p,h])=>({...a,[p]:d(h)?Ht(h):L(h)&&p in a?Wr(a[p],h):M(h)}),e):e},m(t[0])&&[]||{}),Hr=t=>m(t)&&t.length===2&&(A(t[0])||R(t[0])),Br=(t,e)=>{if(!m(t)&&!x(t))return console.error(t,"Expected array or object for obj. Found "+typeof t),t;if(!d(e))return console.error("Expected function for cb. Found "+typeof e),t;let o=Object.entries(t),c=m(t)?[]:{};return o.reduce((a,[p,h])=>{let g=e(p,h);return Hr(g)?zt(a,g[0],g[1]):(console.error(`Callback function must return entry. Found: ${g}. Using current entry instead.`),zt(a,p,h))},c)},ct=(t,e,o={})=>x(t)&&d(e)&&Object.entries(t).reduce((c,[a,p])=>e(a,p,c),o)||o,Kt=t=>{if(!d(t))throw"Argument must be a function";return(...e)=>new Promise((o,c)=>d(e[e.length-1])?(e.pop(),e.push((...a)=>a&&a[0]?c(...a):o(...a)),t(...e)):o(t(...e)))},ln=Array.from(["caller","callee","arguments","apply","bind","call","toString","__proto__","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString"]).concat(Object.getOwnPropertyNames(Object.prototype)).reduce((t,e)=>(t[e]=!0,t),{}),zr=t=>{if(!t.__IS_PROMISIFIED__){for(let e of Object.getOwnPropertyNames(t))if(!(e.indexOf("Async")!==-1||t[`${e}Async`])&&!ln[e])if(d(t[e]))t[`${e}Async`]=Kt(t[e]);else{let o=Object.getOwnPropertyDescriptor(t,e).get;d(o)&&(t[`${e}Async`]=Kt(o))}t.__IS_PROMISIFIED__=!0}return t},qr=t=>Boolean(t&&t instanceof RegExp),Gr=t=>qr(t)?t.source:R(t)?t:null,Kr=t=>{let e={},o=t.split("?"),c=o[o.length-1];if(!c)return e;let a=c.split("&");return a.length&&a.map(p=>{let h=p.split("=");if(h.length<=1)return e;let g=[h.shift(),h.join("=")];if(g.length===2){let _=decodeURIComponent(g[1]).split(",");if(_&&_.length>1)e[g[0]]=_;else if(g[0]in e){let $=e[g[0]];e[g[0]]=m($)?$.push(decodeURIComponent(g[1])):[$,decodeURIComponent(g[1])]}else e[g[0]]=decodeURIComponent(g[1])}}),e};r.applyToCloneOf=(t,e)=>{let o;if(t||(o="object (Argument 1) in applyToCloneOf, must be defined!"),x(t)||(o="object (Argument 1) in applyToCloneOf, must be an object!"),e||(o="mutator (Argument 2) in applyToCloneOf, must be defined!"),d(e)||(o="mutator (Argument 2) arg in applyToCloneOf, must be a function!"),o)return console.warn(o)||t;let c=M(t);return e(c),c},r.applyToFunc=hr,r.areCountMapsEqual=E,r.areFrequencyEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;if(t.length!==e.length)return!1;let c=O(t),a=O(e);return E(c,a)},r.areSetEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;let[c,a]=t.length>e.length?[t,e]:[e,t],p=new Set(a);for(let h=0;h<c.length;h++){let g=c[h];if(!p.has(g))return!1}return!0},r.buildElementCountMap=O,r.buildPath=(...t)=>t.reduce((e,o)=>{let c=toStr(o);return`${e}${c&&"/"+c||""}`},"").replace(/([^:\/]|^)\/{2,}/g,"$1/"),r.camelCase=yr,r.camelCasePath=t=>{let e=t.split(".").map((o,c)=>c>0?pt(o,!1):o);return e.length>1?e.join(""):t},r.capitalize=pt,r.checkCall=(t,...e)=>d(t)?t(...e):void 0,r.cleanColl=Mr,r.cleanStr=It,r.clearObj=Ur,r.cloneArr=t=>Array.from([...m(t)&&t||x(t)&&Object.entries(t)||[]]),r.cloneFunc=Ht,r.cloneJson=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return kr(e.message,"error"),null}},r.cloneObjWithPrototypeAndProperties=jr,r.compareTo=Ut,r.complement=t=>{let[e]=i({predicate:t},{predicate:d});return e?(...o)=>!t(...o):null},r.containsStr=(t,e,o)=>(t=!R(t)&&z(t)||t,e=!R(e)&&z(e)||e,t.indexOf(e,o)!==-1),r.convertToStrBool=$r,r.debounce=(t,e=250,o=!1)=>{let c;return function(...a){if(!d(t))return null;let p=this,h=o&&!c;return clearTimeout(c),c=setTimeout(()=>{c=null,!o&&t.apply(p,a)},e),h?d(t)&&t.apply(p,a):void 0}},r.deepClone=M,r.deepEqual=qt,r.deepFreeze=v,r.deepMerge=Wr,r.delimitString=Rr,r.doIt=(...t)=>{let e=t.slice(),o=e.shift(),c=e.shift(),a=e.pop();if(!A(o)||!d(a))return[];let p=new Array(o),h=[];for(let g=0;g<p.length;g++){let _=a.call(c,g,...e);if(_===!1)break;h.push(_)}return h},r.either=(t,e,o)=>d(o)?o(t,e)&&t||e:wr(t)&&t||e,r.eitherArr=(t,e)=>m(t)?t:e,r.eitherFunc=(t,e)=>d(t)&&t||e,r.eitherObj=(t,e)=>x(t)&&t||e,r.eitherStr=(t,e)=>R(t)&&t||e,r.ensureArr=y,r.equalsNaN=q,r.everyEntry=(t,e)=>t?x(t)?d(e)?Ft(t,Object.entries,o=>o.every(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into everyEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`everyEntry expects argument obj [${t}] to be defined.`),!1),r.exists=et,r.filterObj=(t,e)=>t&&(x(t)?d(e)?ct(t,(o,c,a)=>(e(o,c)&&(a[o]=c),a),{}):(console.error(`Argument 'predicate' passed into filterObject must a function. Found: ${e}`),t):(console.error(`Object ${t} was not an object. It must be for filterObject`),t)),r.findExtrema=Bt,r.findMax=(t=[],e=Wt)=>Bt(t,(o,c)=>Ut(e(o),e(c))),r.findMin=(t=[],e=Wt)=>Bt(t,(o,c)=>Ut(e(c),e(o))),r.flatArr=fr,r.flatMap=(t,e)=>{let[o]=i({arr:t,mapFn:e},{arr:m,mapFn:d});return o?t.reduce((c,a)=>{let p=e(a);return m(p)?p.map(h=>c.push(h)):c.push(p),c},[]):t},r.flatUnion=(...t)=>{let e=t.pop(),o={exists:!0},c=d(e)?e:t.push(e)&&void 0;return t.reduce((a,p)=>m(p)?vr(fr([...a,...p],o),c):a,[])},r.get=nt,r.getNearestDelimiterIndex=Er,r.getNums=ot,r.getRegexSource=Gr,r.getURLParam=t=>{var e,o,c;let[a]=i({paramKey:t},{paramKey:R});if(!a)return null;let p=typeof document<"u"?document:null,h=p==null||(e=p.location)===null||e===void 0?void 0:e.search;return R(h)&&(o=(c=Kr(h))===null||c===void 0?void 0:c[t])!==null&&o!==void 0?o:null},r.getWordEndingAt=(t,e,o=[" "])=>{let c=Xt(t),a=t.length-e;return Xt(Ar(c,a,o))},r.getWordStartingAt=Ar,r.hasDomAccess=()=>{try{return!(typeof window>"u"||!window.document||!window.document.createElement)}catch{return!1}},r.hasOwn=Sr,r.hashString=(t,e)=>{if(!R(t)||t.length==0)return 0;t=t.split("").reverse().join("");let o=0;for(let c=0;c<t.length;c++)o=(o<<5)-o+t.charCodeAt(c),o=`${Math.abs(o&o)}`;return vt(e)?o.slice(0,e):o},r.hyphenator=t=>{if(Ct.hasOwnProperty(t))return Ct[t];let e=t.replace(nn,sn);return Ct[t]=on.test(e)?"-"+e:e},r.identity=Wt,r.isArr=m,r.isArrMap=t=>{if(!x(t))return!1;let e=Object.values(t);return Nt(e.length&&e.every(m))},r.isBool=mt,r.isColl=L,r.isEmail=t=>!t||!R(t)?!1:Boolean(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(t)),r.isEmpty=Ir,r.isEmptyColl=t=>m(t)?t.length===0:L(t)&&Object.getOwnPropertyNames(t).length===0,r.isEntry=Hr,r.isFloat=t=>A(t)&&t%1!=0,r.isFunc=d,r.isInt=t=>A(t)&&t%1==0,r.isLowerCase=gr,r.isNegative=t=>A(t)&&t<0,r.isNonNegative=vt,r.isNum=A,r.isObj=x,r.isOrderable=Tr,r.isPhone=t=>!t||!R(t)?!1:Boolean(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(t))&&t.replace(/\D/g,"").length<11,r.isPositive=t=>A(t)&&t>0,r.isQuoted=(t,e=cn)=>R(t)&&e.some(o=>t.startsWith(o)&&t.endsWith(o)),r.isRegex=qr,r.isSame=(t,e)=>t===e?t!==0||1/t==1/e:t!=t&&e!=e,r.isStr=R,r.isStrBool=Dt,r.isUpperCase=xr,r.isUrl=t=>Boolean(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(t)),r.isUuid=t=>!t||!R(t)?!1:Boolean(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t)),r.isValidDate=t=>!isNaN((t instanceof Date&&t||new Date(t)).getTime()),r.isValidUrl=t=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?/.test(t),r.joinRegex=(...t)=>{let[e,o]=(a=>{if(m(a[0]))return[a[0],a[1]];let p=a[a.length-1],h=R(p)?p:void 0;return[h?a.splice(0,a.length-1):a,h]})(t),c=e.reduce((a,p)=>{let h=Gr(p);return h?a===""?h:`${a}|${h}`:a},"");return new RegExp(`(${c})`,o)},r.jsonEqual=(t,e)=>{try{return JSON.stringify(t)===JSON.stringify(e)}catch{return!1}},r.keyMap=(t,e)=>m(t)&&t.reduce((o,c)=>{if(!R(c))return o;let a=e&&c.toUpperCase()||c;return o[a]=a,o},{})||{},r.limbo=t=>t&&d(t.then)?t.then(e=>[null,e]).catch(e=>[e,void 0]):[new Error("A promise or thenable is required as the first argument!"),null],r.logData=kr,r.mapColl=(t,e)=>d(e)&&L(t)?Object.keys(t).map(o=>e(o,t[o],t)):m(t)?[]:{},r.mapEntries=Br,r.mapFind=(t,e,o=et)=>{let[c]=i({coll:t,mapper:e,test:o},{coll:L,$default:d});if(c)return x(t)?((a,p,h)=>{let g=0;for(let _ in a){if(!a.hasOwnProperty(_))continue;let $=p(a[_],_,g);if(h($,_,g))return $;g++}return null})(t,e,o):((a,p,h)=>{for(let g=0;g<a.length;g++){let _=p(a[g],g,g);if(h(_,g,g))return _}return null})(t,e,o)},r.mapKeys=(t,e)=>x(t)&&d(e)?Br(t,(o,c)=>[e(o),c]):t,r.mapObj=(t,e)=>x(t)&&d(e)&&Object.entries(t).map(([o,c])=>e(o,c))||t,r.mapString=dr,r.match=Fr,r.memorize=(t,e,o=1)=>{if(!d(t)||e&&!d(e))return console.error("Error: Expected a function",t,e);let c=function(){let a=c.cache,p=e?e.apply(this,arguments):arguments[0];if(Sr(a,p))return a[p];let h=t.apply(this,arguments);return A(o)&&Object.keys(a).length<o?a[p]=h:c.cache={[p]:h},h};return c.cache={},c.destroy=()=>{e=void 0,c.cache=void 0,c.destroy=void 0,c=void 0},c},r.mod=(t,e)=>(t%e+e)%e,r.noOp=()=>{},r.noOpObj=lt,r.noPropArr=en,r.noPropObj=N,r.nth=t=>{if(!A(t)&&(!(t=ot(t))||(t=kt(t),q(t))))return"";let e=t%100;if(e>=10&&e<=20)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},r.objToQuery=t=>{let e;return ct(t,(o,c,a)=>{if(!c)return a;let p=R(c)||A(c)||mt(c)?c:L(c)?m(c)?c.join(","):JSON.stringify(c):null;return p&&(a=e?`${a}&${encodeURIComponent(o)}=${encodeURIComponent(p)}`:`?${encodeURIComponent(o)}=${encodeURIComponent(p)}`,e=!0),a},"")},r.omitKeys=(t={},e=[])=>x(t)&&ct(t,(o,c,a)=>(e.indexOf(o)===-1&&(a[o]=t[o]),a),{})||{},r.omitRange=(t,e,o)=>{let[c]=i({arr:t,startIndex:e,count:o},{arr:m,$default:vt});if(!c)return t;let a=[...t];return a.splice(e,o),a},r.parseErrorMessage=t=>R(t)&&!Ir(t)?t:x(t)?t.message:null,r.parseJSON=(t,e=!0)=>{try{return JSON.parse(t)}catch(o){return e&&console.error(o.message),null}},r.pickKeys=(t={},e=[])=>x(t)&&e.reduce((o,c)=>(c in t&&(o[c]=t[c]),o),{})||{},r.pipeline=Ft,r.plural=t=>t&&t.length&&t[t.length-1]!=="s"?t+"s":t,r.promisify=Kt,r.promisifyAll=t=>{if(!x(t))return t;zr(t);let e=Object.getPrototypeOf(t);return e&&Object.getPrototypeOf(e)!==null&&zr(e),t},r.queryToObj=Kr,r.randomArr=(t,e)=>{if(!m(t))return t;let o=e||1,c=[];for(let a=0;a<o;a++)c.push(t[Math.floor(Math.random()*t.length)]);return e?c:c[0]},r.randomizeArr=t=>!m(t)&&t||t.sort(()=>.5-Math.random()),r.reduceColl=(t,e,o)=>d(e)&&L(t)?Object.keys(t).reduce((c,a)=>e(a,t[a],t,c),o):m(t)?[]:{},r.reduceObj=ct,r.removeDot=Or,r.repeat=(t,e,o=!1)=>{if(!e||e<=0)return[];if(!A(e))return console.error("Times argument must be a number"),[];let c=[];for(let a=0;a<e;a++){let p=d(t)?t():o?M(t):t;c.push(p)}return c},r.resetLogs=()=>{Gt=void 0,st="log",G="type"},r.reverseStr=Xt,r.runSeq=async(t=[],e={})=>{let[o]=i({asyncFns:t},{asyncFns:m});if(!o)return[];let{cloneResults:c=!1,returnOriginal:a=!0}=e,p=[];for(let h of t){let g=d(h)?await h(p.length,c?M(p):p):a?h:void 0;p.push(g)}return p},r.sanitize=_r,r.sanitizeCopy=t=>JSON.parse(_r(JSON.stringify(t))),r.set=zt,r.setLogs=(t,e,o)=>{Gt=t,st=e||st||"log",G=o||G||"type"},r.shallowEqual=(t,e,o)=>{if(o&&(m(o)||R(o))&&(t=nt(t,o),e=nt(e,o)),t===e)return!0;if(!(t&&L(t)&&e&&L(e))||Object.keys(t).length!==Object.keys(e).length)return!1;for(let c in t)if(t[c]!==e[c])return!1;return!0},r.singular=t=>t&&t.length&&t[t.length-1]==="s"?t.slice(0,t.length-1):t,r.snakeCase=t=>Rr(t,"_").toLowerCase(),r.softFalsy=wr,r.someEntry=(t,e)=>t?x(t)?d(e)?Ft(t,Object.entries,o=>o.some(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into someEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`someEntry expects argument obj [${t}] to be defined.`),!1),r.spaceJoin=(t,e)=>(e=m(e)?e:[e]).reduce((o,c)=>R(c)?`${o?o+" ":""}${c}`.trim():o,R(t)?t:""),r.splitByKeys=(t={},e)=>{if(!e)return[{},{...t}];let o=[{},{}],c=y(e);return x(t)?ct(t,(a,p,h)=>(et(c.find(g=>et(g)&&z(g)===a))?h[0][a]=t[a]:h[1][a]=t[a],h),o):o},r.strToType=Nr,r.styleCase=t=>{if(!R(t))return t;let e=yr(t);return`${e[0].toLowerCase()}${e.slice(1)}`},r.template=br,r.throttle=(t,e=100)=>{let o=!1;return function(...c){if(!o)return o=!0,t.apply(this,c),setTimeout(()=>{o=!1},e)}},r.throttleLast=(t,e,o=100)=>{let c;return function(...a){c&&clearTimeout(c),c=setTimeout(()=>{t.apply(this,a),clearTimeout(c)},o),typeof e=="function"&&e()}},r.timedRun=async(t,...e)=>{let[o]=i({fn:t},{fn:d});if(!o)return[void 0,-1];let c=new Date;return[await t(...e),new Date-c]},r.toBool=Nt,r.toFloat=t=>t&&!q(t)&&parseFloat(A(t)&&t||ot(t))||0,r.toInt=t=>t&&!q(t)&&parseInt(A(t)&&t||ot(t))||0,r.toNum=kt,r.toObj=(t,e,o)=>m(t)?Object.keys(t).reduce((c,a)=>(c[a]=t[a],c),{}):R(str)?(e=e||"=",o=o||"&",str.split(o).reduce((c,a)=>{let p=a.split(e);return c[p[0].trim()]=Nr(p[1].trim()),c},{})):{},r.toStr=z,r.trainCase=t=>R(t)&&t.split(/(?=[A-Z])|[\s_-]/gm).join("-").toLowerCase()||t,r.trimStringFields=t=>Object.entries(t).reduce((e,[o,c])=>(e[o]=R(c)?c.trim():c,e),t),r.typeOf=Pr,r.uniqArr=vr,r.uniqArrByReference=Cr,r.unset=(t,e)=>Mt(t,e,"unset"),r.uuid=Lr,r.validFilename=t=>t?!(/[<>:"/\\|?*\u0000-\u001F]/g.test(t)||/^(con|prn|aux|nul|com\d|lpt\d)$/i.test(t)||/^\.\.?$/.test(t)):!1,r.validate=i,r.wait=t=>new Promise(e=>setTimeout(()=>e(!0),t)),r.wordCaps=t=>R(t)?It(t).split(" ").map(e=>e&&pt(e)||"").join(" "):t})});var Fo={};xn(Fo,{setParkinGlobals:()=>Po});module.exports=Rn(Fo);var Qr=T(w()),P=(0,Qr.deepFreeze)({ALIAS_REF:"$$",ALIAS_WORLD_KEY:"$alias",ALIAS_REF_AT_RUNTIME:"$$:",REGEX_VARIANT:"regex",WORLD_REF:"$",WORLD_KEY:"$world",WORLD_AT_RUNTIME:"$:",EXPRESSION_VARIANT:"expression",STEP_TYPES:["given","when","then","and","but"],HOOK_TYPES:["beforeAll","afterAll","beforeEach","afterEach"],FEATURE_META:["feature","perspective","desire","reason","comments"],LOG_JEST_SPEC_ENV:"PARKIN_LOG_JEST_SPEC",SPEC_RESULT_LOG:"------- PARKIN SPEC RESULT LOG -------"});var Oe=T(w());var Et=T(w());var X=(r,n,s)=>{let i=r.match(n)[s];return i?i.trim():" "},F=(r,n)=>{let s=r&&r.trim()&&r.trim().toLowerCase().replace(/[\s\/\\\(\)\+=_&%\$#@!\*~`\|\?:;"'<>,.{}]/g,"-");return s?`${s}-${r.length}`:`${n}-${n.length}`},Yr=r=>{let n=r.match.toString();return n[0]==="/"&&(n=n.substr(1)),n[0]==="^"&&(n=n.substr(1)),n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n.charAt(n.length-1)==="$"&&(n=n.slice(0,-1)),n.replace(/\(\?:([^\|]+)+\|+([^\)]+)?\)/,"$1")},Zr=(r,n)=>n.reduce((s,i)=>!s||i.content===s.content?!1:(i.uuid===s.uuid&&(s.uuid=`${s.uuid}-${s.content.length}`),s),{...r}),dt=r=>r.trim().replace(/^("|')/,"").replace(/("|')$/,"");var b=T(w());var te=T(w()),it=/\w*\([^)]*?\)/,gt=/\s*\S*\/\S*\s*/,H=/\s*{(.*?)}\s*/,re=(0,te.joinRegex)(H,it,"g"),Vt=/(.*)/,xt=/{|}/g,Rt=/"[^"]+"/,Ot=/'[^']+'/,yt=/-?[0-9]+[.][0-9]+/,_t=/-?[0-9]+/,ee=/^["]?\$world\.\S+["]?/,ne=/^\$world\./,oe=/(\$:world|\$world)+\.[^"'\s]*/gm,se=/^["]?\$\$\S+["]?/,ce=/^\$\$/,ie=/(\$\$:\w+|\$\$\w+)[^"'\s]*/gm;var ae=r=>()=>{throw new Error(`Test method ${r} does not exist on the global scope.
Please ensure ${r} exists before calling the run method!
`)},ue=()=>{throw new Error("Runner class constructor requires an instance of the Steps class")};var le=()=>{throw new Error("Runner class requires feature text when calling the run method")},pe=r=>{throw new ReferenceError(r)},me=()=>{throw new Error(`Cannot register param type "${name}". It already exists!`)},fe=r=>{throw new Error("Assemble feature requires an object matching the feature model spec!",r)},he=(r,n)=>{throw new Error(`Can not replace ${r} with value from $world, it does not exist on the world object`,n,r)},de=(r,n)=>{throw new Error([`Expected client hook type to be one of ', ${r}.`,`Found: ${n}`].join(`
`))},ge=(r,n)=>{throw console.error(`Error replacing $world value in feature text. Current match was ${n}`),r},xe=(r,n)=>{throw console.error(`Error replacing $$alias ( $world.$alias ) in feature text. Current match was ${n}`),r};var{WORLD_KEY:On,ALIAS_WORLD_KEY:yn,ALIAS_REF:_n}=P,J=(r,n)=>(s,i)=>{let u=s.match(ee),l=s.match(se);if(!(0,b.isObj)(i)||!u&&!l)return Qt(r(s),n);let f=u?(0,b.get)(i,dt(s).replace(`${On}.`,"")):(0,b.get)(i,dt(s).replace(`${_n}`,`${yn}.`));return(0,b.exists)(f)?Qt(f,n):u?he(s,i):Qt(r(s),n)},Qt=(r,n)=>typeof r===n?r:null,k={name:"",regex:"",type:"string",useForSnippets:!0,preferForRegexpMatch:!1,transformer:J(r=>r,"string")},U={any:{...k,name:"any",regex:Vt},word:{...k,name:"word",regex:Vt,transformer:J(r=>(0,b.isQuoted)(r)?void 0:(0,b.toStr)(r),k.type)},float:{...k,name:"float",type:"number",regex:yt,transformer:J(r=>{let n=parseFloat(r);return(0,b.equalsNaN)(n)?void 0:n},"number")},int:{...k,name:"int",type:"number",regex:_t,transformer:J(r=>{let n=parseInt(r);return(0,b.equalsNaN)(n)||r.includes(".")?void 0:n},"number")},string:{...k,name:"string",regex:(0,b.joinRegex)(Rt,Ot),transformer:J(r=>(0,b.isQuoted)(r)?dt(r):void 0,k.type)}},V=()=>U,bt=(r=b.noOpObj,n=r.name)=>U[n]?me(n):(U[n]={...k,...r},U[n].transformer=J(U[n].transformer,U[n].type),U),Re=(r,n,s)=>r.map((i,u)=>{let l=n[u]||U.any;return(0,b.checkCall)(l.transformer,i,s)}).filter(b.exists);var Q=(r,n)=>{let s=n.match(new RegExp(r.match));return s?{definition:r,match:s.slice(1,s.length).filter(Boolean)}:Et.noOpObj},Zt=r=>{let n=r.split(/(\(|\))/),[s,,i,,u]=n;return s===""&&u===""?r+"?":s===""?`(${i}|${i}${u})`:u===""?`(${s}|${s}${i})`:`(${s}${u}|${s}${i}${u})`},bn=r=>{let n=r.input;return(0,Et.getWordEndingAt)(n,r.index)+r[0]},En=r=>{let n=bn(r);return Zt(n)},tr=r=>{let n=V();return(n[r]||n.any).regex.source},rr=r=>`(${r.trim().replace(/\//g,"|")})`,An=(r,n)=>{let[s,i]=n;switch(r){case"parameter":return new RegExp(tr(i));case"optional":return new RegExp(En(n));case"alternate":return new RegExp(rr(s));default:return null}},Yt=(r,n="other")=>{let s=r[0],i=s.trimStart(),u=s.length-i.length;return{text:s.trim(),input:r.input,index:r.index+u,regex:An(n,r),type:n,...n==="parameter"&&{paramType:s.trim().replace(xt,"")}}},Y=r=>{let n=[...r.matchAll(new RegExp(H,"gi"))].map(l=>Yt(l,"parameter")),s=[...r.matchAll(new RegExp(it,"gi"))].map(l=>Yt(l,"optional")),i=[...r.matchAll(new RegExp(gt,"gi"))].map(l=>Yt(l,"alternate"));return[...n,...s,...i].sort((l,f)=>l.index-f.index)};var $n=(0,Oe.joinRegex)(_t,yt,H,Rt,Ot,"g"),ye=(r,n)=>{let s=Y(n.match),i=[],u,l=0;for(;(u=$n.exec(r))!==null;){let[f,m,...O]=u,E=O.pop(),x=s[l],y=f.trimStart(),d=f.length-y.length;i.push({match:f.trim(),defIndex:x==null?void 0:x.index,index:u.index+d,type:E||(x==null?void 0:x.paramType)||"any"}),l++}return i};var we=T(w());var I=T(w()),er=Boolean(typeof window<"u"),_e=Boolean(typeof global<"u"),wn=Boolean(typeof module=="object"),Tn=Boolean(typeof require=="function"),nr=Boolean(_e&&typeof global.jasmine<"u"),be=()=>nr?(0,I.checkCall)(()=>global.jasmine):{getEnv:()=>I.noOpObj},Ee=()=>wn?(0,I.checkCall)(()=>module):{exports:{}},Ae=()=>Tn?(0,I.checkCall)(()=>require):I.noOp,At=()=>{try{return er?(0,I.checkCall)(()=>window):_e?(0,I.checkCall)(()=>global):I.noOpObj}catch{return I.noOpObj}};var Z=T(w());var Sn=r=>er?r.replace(/[|\\[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"):r.replace(/[|\\[\]^$+*?.]/g,"\\$&"),$e=(r,n,s)=>{if(!n.test(r))return r;let i=r;return r.replace(n,(...u)=>{let l=u[0].trim(),[f,...m]=i.split(l),O=(0,Z.isFunc)(s)?s(...u):s;i=`${f}${O}${m.join(l)}`}),i},jn=r=>{let n=V(),s=[];return{regex:$e(r,re,(u,...l)=>{let f=u.trim().replace(xt,""),m=u.match(H),O=u.match(it);return m&&s.push(n[f]||n.any),m?tr(f):O?Zt(u):u}),transformers:s}},Ln=r=>{let n=[];return{regex:$e(r,new RegExp(gt,"g"),rr),altIndexes:n}},Pn=r=>{let n=r;return r.startsWith("^")||(n="^"+n),r.endsWith("$")||(n+="$"),{regex:n}},or=(r,n,s)=>{let i=Y(n),u=i.filter(f=>f.type==="parameter").length,l=i.reduce((f,m)=>{let{params:O,textIndex:E,wordMatchIndex:x}=f,y=r.substring(E),d=m.paramType==="word",v=y.match(m.regex),lt={0:s[x],index:y.indexOf(s[x])},N=d?lt:v;return N?(m.type==="parameter"&&N&&O.push(N[0]),{params:O,textIndex:E+(N&&N.index+N[0].length),wordMatchIndex:x+(d&&1)}):f},{params:[],textIndex:0,wordMatchIndex:0});return u===l.params.length?l.params:null},sr=(r,n)=>{let s=Sn(r.match),{regex:i}=Ln(s),{transformers:u,regex:l}=jn(i),{regex:f}=Pn(l);return{found:Q({...r,match:f},n),escaped:s,regexAlts:i,transformers:u,regexAnchors:f,regexConverted:l}},$t=(r,n,s)=>{if(r.match===n)return{definition:r,match:[]};let{found:i,transformers:u}=sr(r,n);if(!i||!i.definition||!i.match)return Z.noOpObj;let l=or(n,r.match,i.match);if(!l)return Z.noOpObj;let f=Re(l,u,s);return f.length!==l.length?Z.noOpObj:{definition:r,match:f}};var{REGEX_VARIANT:Fn}=P,wt=class{constructor(){this.find=cr;this.regex=Q;this.parts=Y;this.types=V;this.stepTokens=ye;this.extract=or;this.expression=$t;this.expressionFind=sr;this.register=bt}},cr=(r,n,s)=>r.reduce((i,u)=>i.match||!u.match?i:u.variant!==Fn?$t(u,n,s):Q(u,n),we.noOpObj);var D=T(w());var{REGEX_VARIANT:Te,EXPRESSION_VARIANT:In,STEP_TYPES:Cn}=P,vn=r=>{let n=r.variant===Te?r.match.toString():`"${r.match}"`;return`${(0,D.capitalize)(r.type)}(${n}, ${r.method.toString()})`},Mn=function(r,n,s,i,u=D.noOpObj){let l={type:n,meta:u,match:s,method:i,tokens:[],variant:s.toString().indexOf("/")===0?Te:In};l.name=Yr(l),l.uuid=F(`${n}-${l.name}`),l.content=vn(l);let f=this.list(),m=Zr(l,f);return m&&this[r].push(m),m},Xn=(r,n,s)=>(...i)=>{let u=r[n](...i);return s[n].push(u),u},Dn=function(r){let n=this.types.map(i=>(0,D.capitalize)(i)),s=n.reduce((i,u)=>(i[u]=[],i),{});return(0,D.eitherArr)(r,[r]).map(i=>{Function(`return (global, require, module, ${n.join(",")}) => {
          return (function(global) { ${i} }).call(global, global)
        }`)()(At(),Ae(),Ee(),...n.map(u=>Xn(this,u,s)))}),s},Nn=r=>r.types.reduce((n,s)=>n.concat(r[`_${s}`]),[]),Tt=class{types=Cn;constructor(n){this._world=n||{};let s=this;this.types.map(i=>{let u=`_${i}`;this[u]=[],this[(0,D.capitalize)(i)]=(l,f,m)=>s.register(u,i,l,f,m)})}list=()=>Nn(this);typeList=()=>this.types.reduce((n,s)=>{let i=`_${s}`;return n[i]=[...this[i]],n},{});match=n=>{let s=this.list(),i=cr(s,n,this._world);return!i.match||!i.definition?!1:(i.match.push(this._world),i)};resolve=n=>{let s=this.match(n);return s?s.definition.method(...s.match):pe(`Matching definition could not be found for step: "${n}"`)};register=(...n)=>(0,D.isStr)(n[0])?Mn.apply(this,n):Dn.apply(this,n);clear=()=>{this.types.map(n=>this[`_${n}`]=[])}};var tt=T(w());var{HOOK_TYPES:Se}=P,St=class{types=Se;instance=void 0;constructor(n,s){this._registeredHooks={},this.instance=s,this.types.map(i=>{this[i]=u=>{(0,tt.isFunc)(u)&&(this._registeredHooks[i]=this._registeredHooks[i]||[],this._registeredHooks[i].push(u))}})}getRegistered=n=>{let s=this.types.includes(n)?this._registeredHooks[n]||tt.noPropArr:de(Se.join(", "),n);return s.length?async()=>s.reduce(async(i,u)=>(await i,await u(this.instance)),Promise.resolve()):tt.noOp}};var kn=/^\s*Given (.*)$/,Un=/^\s*When(.*)$/,Wn=/^\s*Then (.*)$/,Hn=/^\s*And (.*)$/,Bn=/^\s*But (.*)$/,zn=/^\s*\* (.*)$/,qn=/^\s*?"""\s*?/;var Gn=/^\s*?```\s*?/;var je=/^\s*?\|/;var Kn=[{regex:kn,type:"given"},{regex:Un,type:"when"},{regex:Wn,type:"then"},{regex:Hn,type:"and"},{regex:Bn,type:"but"},{regex:zn,type:"and"}],Jn=(r,n,s,i)=>{if(!je.test(s))return r;let u;return r.table={index:i,content:n.reduce((l,f)=>(u=u||!je.test(f),!u&&l.push(f.split("|").reduce((m,O)=>{let E=O.trim();return E&&m.push(E),m},[])),l),[])},r},Vn=(r,n,s,i)=>{let u=qn.test(s)&&'"""';if(u=u||Gn.test(s)&&"```",!u)return r;let l=s.split(u)[0],f=new Array(l.length).fill("\\s").join(""),m=new RegExp(`^${f}`);return r.doc={index:i,whiteSpace:l,type:u==='"""'?"quote":"tick",content:n.split(u).slice(1).shift().trim().split(`
`).reduce((O,E)=>(O.push(E.replace(m,"").trim()),O),[]).join(`
`)},r},Qn=(r,n,s,i)=>{let u={type:r,index:i,step:n,uuid:F(`${r}-${n}`)},l=i+1,f=s[l],m=s.slice(l);return u=Jn(u,m,f,l),u=Vn(u,m.join(`
`),f,l),u},Le=(r,n,s,i)=>Kn.reduce((u,l)=>{if(u)return u;let f=l.regex.test(s);return f&&r.steps.push(Qn(l.type,X(s,l.regex,1),n,i)),f},!1);var Xe=T(w());var rt=T(w());var{ALIAS_REF:Yn,WORLD_REF:Zn,ALIAS_WORLD_KEY:to,WORLD_AT_RUNTIME:Pe,ALIAS_REF_AT_RUNTIME:Fe}=P,Ie=(r,n,s)=>{let i=(0,rt.get)(n,s);return(0,rt.isFunc)(i)?i(n,s):(0,rt.exists)(i)?i:r},ro=(r,n)=>{let s;try{return r.replace(ie,i=>{s=i;let u=i.trim();return u.indexOf(Fe)===0?u.replace(Fe,`$${Yn}`):Ie(i,n,u.replace(ce,`${to}.`))})}catch(i){xe(i,s)}},eo=(r,n)=>{let s;try{return r.replace(oe,i=>{s=i;let u=i.trim();return u.indexOf(Pe)===0?u.replace(Pe,Zn):Ie(i,n,u.replace(ne,""))})}catch(i){ge(i,s)}},Ce=(r,n)=>eo(ro(r,n),n);var no=/\r?\n/g,ve=/^\s*@(.*)$/,Me=/^\s*#(.*)$/,ir=/^\s*Feature:(.*)$/,ar=/^\s*Rule:(.*)$/,oo=/^\s*As (.*)$/,so=/^\s*I want (.*)$/,co=/^\s*So that (.*)$/,io=/^\s*In order (.*)$/,ur=/^\s*Scenario:(.*)$/,lr=/^\s*Example:(.*)$/,De=/^\s*Background:(.*)$/,ao=[{regex:oo,key:"perspective"},{regex:so,key:"desire"},{regex:co,key:"reason"},{regex:io,key:"reason"}],Ne=(r,n,s)=>({index:s,content:n,feature:r,tags:[],rules:[],reason:[],comments:[],scenarios:[],...r&&{uuid:F(r,s)}}),ke=(r,n)=>({index:n,rule:r,tags:[],scenarios:[],...r&&{uuid:F(r,n)}}),Ue=(r,n)=>({index:n,scenario:r,tags:[],steps:[],...r&&{uuid:F(r,n)}}),We=(r,n)=>({index:n,steps:[],background:r,...r&&{uuid:F(r,n)}}),uo=(r,n,s)=>{n&&r.reason.push({content:n,index:s})},lo=(r,n,s)=>{let i=!1;return ao.reduce((u,l)=>{if(u)return u;let f=l.regex.test(n);return!i&&f&&(i=!0),f&&(l.key==="reason"?uo(r,X(n,l.regex,0),s):r[l.key]={content:X(n,l.regex,0),index:s})},!1),i},po=(r,n,s,i)=>{if(!ve.test(s))return!1;let u=r.background?n:r,l=X(s,ve,0);return u.tags=(u.tags||[]).concat(l.split(" ")),!0},mo=(r,n,s)=>{if(!Me.test(n))return!1;let i=n.match(Me)[0];return r.comments.push({content:i,index:s}),!0},fo=(r,n,s,i,u)=>{if(!ir.test(s))return n;let l=X(s,ir,1);if(!n.feature)return n.feature=l,n.index||(n.index=u),n.uuid||(n.uuid=F(n.feature,u)),!r.includes(n)&&r.push(n),n;let f=Ne(l,i,u);return r.push(f),f},ho=(r,n,s,i)=>{if(!ar.test(s))return n;let u=X(s,ar,1);return n.rule?n=ke(u,i):n.rule=u,!n.index&&(n.index=i),!n.uuid&&(n.uuid=F(n.rule,i)),!r.rules.includes(n)&&r.rules.push(n),n},go=(r,n,s,i,u)=>{let l=ur.test(i);if(!l&&!lr.test(i))return s;let f=l&&X(i,ur,1);f=f||X(i,lr,1),s.scenario?s=Ue(f,u):s.scenario=f,!s.index&&(s.index=u),!s.uuid&&(s.uuid=F(s.scenario,u));let m=n.uuid?n:r;return!m.scenarios.includes(s)&&m.scenarios.push(s),s},xo=(r,n,s,i,u)=>{if(!De.test(i))return s;let l=n.uuid?n:r,f=`${l.uuid}-background`;return s.background?s=We(f,u):s.background=f||"",!s.index&&(s.index=u),!s.uuid&&(s.uuid=F(s.background,u)),l.background=s,s},Ro=(r,n,s,i,u,l)=>ur.test(l)||lr.test(l)?i:ir.test(l)?n:ar.test(l)?s:De.test(l)?u:r,jt=function(r,n){n=n||this&&this.world||Xe.noOpObj;let s=[],u=Ce((r||"").toString(),n).split(no),l=ke(!1),f=Ue(!1),m=We(!1),O=Ne(!1,r),E=O;return u.reduce((x,y,d)=>(O=fo(x,O,y,r,d),mo(O,y,d)||lo(O,y,d)||(l=ho(O,l,y,d),f=go(O,l,f,y,d),m=xo(O,l,m,y,d),!E.feature&&Le(E,u,y,d))||(E=Ro(E,O,l,f,m,y),po(E,O,y,d)),x),s)};var He=function(r){return this.steps.register([r])};var at=T(w());var{SPEC_RESULT_LOG:Be,LOG_JEST_SPEC_ENV:Oo}=P,Lt=r=>{let n=new Date().getTime();(0,at.get)(process,`env.${Oo}`)&&process.stdout.write([Be,JSON.stringify({...r,timestamp:n}),Be].join(""))},ze=r=>{let n=(0,at.get)(r,"description"),s=n?n.startsWith("Scenario >")?"Scenario":n.startsWith("Background >")?"Background":n.startsWith("Rule >")?"Rule":"Feature":"Feature";return{type:s.toLowerCase(),...s!=="Feature"&&{description:n.replace(`${s} >`,`${s}:`)}}},W=(r,n)=>n?at.noOp:global[r]||ae(r),yo=r=>{let n=[],s=r.describe;return r.describe=(...i)=>{let u=s.apply(null,i);return n.push(u),u},{suiteStarted:i=>{Lt({...i,...ze(i),action:"start"})},specStarted:i=>{Lt({...i,type:"step",action:"start"})},specDone:i=>{if(Lt({...i,type:"step",action:"end"}),i.status!=="failed")return;let u=n.find(l=>l.children.find(f=>f.result===i));u&&u.children.map(l=>l.disable())},suiteDone:i=>{Lt({...i,...ze(i),action:"end"})}}},qe=r=>{if(!nr)return;let n=be().getEnv();n&&n.describe&&n.addReporter(yo(n,r))};var j=T(w()),pr=(r,n)=>`${(0,j.capitalize)(n)} > ${r}`,Je=(r,n)=>(0,j.isStr)(r)?jt(r,n):(0,j.isObj)(r)?[r]:(0,j.isArr)(r)?r.reduce((s,i)=>s.concat(Je(i,n)),[]):le(),_o=async(r,n,s)=>{W("test",s)(`${(0,j.capitalize)(n.type)} ${n.step}`,async()=>await r.resolve(n.step))},Ge=(r,n,s,i)=>{let u=W("describe",i),l=[];return u(n,()=>{let f=r.steps.map(m=>_o(s,m,i));Promise.all(f)}),l},Ve=(r,n,s,i)=>(s&&Ge(s,pr(n.scenario,"Background"),r,i),Ge(n,pr(n.scenario,"Scenario"),r,i)),bo=(r,n,s,i)=>{let u=[];return describe(`Rule > ${n.rule}`,()=>{u=n.scenarios.map(l=>Ve(r,l,s||n.background,i)),Promise.all(u)}),u},Eo=r=>(0,j.isStr)(r)&&r.match(/[@]\w*/g),Ke=(r="",n=[],s={})=>{let{name:i,tags:u}=s,l=(0,j.isStr)(u)?Eo(u):(0,j.eitherArr)(u,[]),f=!i||r.includes(i),m=!l.length||l.every(O=>n.includes(O));return f&&m},Ao=(r,n={})=>r.reduce((s,i)=>{if(Ke(i.feature,i.tags,n))return s.push(i),s;let l=i.scenarios.filter(f=>Ke(f.scenario,[...f.tags||[],...i.tags||[]],n));return l.length&&s.push({...i,scenarios:l}),s},[]),Pt=class{constructor(n,s,i){!n&&ue(),!s&&throwMissingHooks(),this.steps=n,this.hooks=s,this._world=i}getFeatures=(n,s)=>{let i=Je(n,this._world);return Ao(i,s)};run=async(n,s=j.noOpObj)=>{let i=this.run.PARKIN_TEST_MODE;qe(i);let u=W("describe",i),l=W("beforeAll",i),f=W("afterAll",i),m=W("beforeEach",i),O=W("afterEach",i),E=this.getFeatures(n,s);if(!E.length)return!1;let x=await E.map(async y=>{let d=[];return l(this.hooks.getRegistered("beforeAll")),f(this.hooks.getRegistered("afterAll")),m(this.hooks.getRegistered("beforeEach")),O(this.hooks.getRegistered("afterEach")),u(pr(y.feature,"Feature"),()=>{d=y.rules.map(v=>bo(this.steps,v,y.background,i)),d.concat(y.scenarios.map(v=>Ve(this.steps,v,y.background,i))),Promise.all(d)}),d});return await Promise.all(x),!0}};var S=T(w()),{FEATURE_META:$o}=P,B=(r,n,s)=>{(0,S.exists)(s)?(0,S.exists)(r[s])?r.splice(s,0,n):r[s]=n:r.push(n)},Qe=(r,n,s="")=>{(0,S.isArr)(n)&&n.length&&B(r,`${s}${n.join(" ")}`)},wo=(r,n)=>{$o.map(s=>{switch(s){case"feature":B(r,`Feature: ${n[s]}`,n.index);break;case"comments":(0,S.isArr)(n[s])&&n[s].map(i=>B(r,i.content,i.index));break;case"reason":(0,S.isArr)(n[s])&&n[s].map(i=>B(r,`  ${i.content}`,i.index));break;case"desire":case"perspective":n[s]&&B(r,`  ${n[s].content}`,n[s].index);break}})},To=(r,n)=>{(0,S.isArr)(n.steps)&&n.steps.length&&n.steps.map(s=>B(r,`    ${(0,S.capitalize)(s.type)} ${s.step}`,s.index))},So=(r,n)=>{n.scenarios&&n.scenarios.map(s=>{Qe(r,s.tags,"  "),B(r,`  Scenario: ${s.scenario}`,s.index),To(r,s)})},jo=(r,n,s)=>{let i=r[s+1],u=r[s-1],l=(0,S.exists)(i)?i:u;if(!l)return`${n}
`;let f=n.split("#").pop();return`${Array(l.length-l.trimStart().length).join(" ")} # ${f}
`},Lo=r=>Array.from(r,(n,s)=>(0,S.exists)(n)?n.startsWith("#")?jo(r,n,s):`${n}
`:`
`).join("").trim(),Ye=r=>(0,S.eitherArr)(r,[r]).map(n=>{let s=[];return!(0,S.isObj)(n)&&fe(n),Qe(s,n.tags),wo(s,n),So(s,n),Lo(s)});var Ze={feature:Ye};var C=T(w()),ut=class{constructor(n,s){(0,C.isObj)(n)&&this.init(n,s)}#t=!1;init=(n=C.noOpObj,s)=>{if(this.#t)return console.warn("This instance of parkin has already been initialized!");(0,C.isObj)(n.$alias)||(n.$alias={}),this.#t=!0,this.world=n,this.steps=new Tt(this.world),this.hooks=new St(this.world),this.runner=new Pt(this.steps,this.hooks,this.world),this.run=this.runner.run,this.parse={feature:jt.bind(this),definition:He.bind(this)},this.assemble=Ze,this.paramTypes={register:bt},this.matcher=new wt,(0,C.isObj)(s)&&this.registerSteps(s),this.steps.types.map(i=>{this[(0,C.capitalize)(i)]=(u,l,f)=>this.steps.register(`_${i}`,i,u,l,f)})};registerSteps=n=>{Object.entries(n).map((s,i)=>Object.entries(i).map((u,l)=>this.steps[(0,C.capitalize)(s)](u,...(0,C.eitherArr)(l,[l]))))}},tn=new ut;var rn=r=>{let n=At(),s=r||process.env.PARKIN_TEST_GLOBALS_OVERRIDE;(!n.Parkin||s)&&(n.Parkin=ut),(!n.PK||s)&&(n.PK=tn)};rn();var Po=(r=!0)=>rn(r);0&&(module.exports={setParkinGlobals});
//# sourceMappingURL=global.js.map
